# Phase 1 ì‹¤ì œ í…ŒìŠ¤íŠ¸ ë° ì˜¤ë¥˜ í•´ê²° ê³¼ì •

**ì‘ì„±ì¼**: 2025-08-20  
**ì‘ì—…ì**: Claude Code Assistant  
**ë‹¨ê³„**: Phase 1 Frontend-Backend Integration Testing

## ğŸ“‹ í…ŒìŠ¤íŠ¸ ê°œìš”

Phase 0ì—ì„œ êµ¬í˜„ëœ í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œë¥¼ ì‹¤ì œ ì—°ë™ í…ŒìŠ¤íŠ¸í•˜ëŠ” ê³¼ì •ì—ì„œ ë°œìƒí•œ ë‹¤ì–‘í•œ ì˜¤ë¥˜ë“¤ê³¼ í•´ê²° ê³¼ì •ì„ ê¸°ë¡í•©ë‹ˆë‹¤. ì‚¬ìš©ìê°€ "í”„ë¡ íŠ¸ì—”ë“œì—ì„œëŠ” í˜ì´ì§€ ì¶”ì¶œ ë° ì¸ë„¤ì¼ ê²°ê³¼ê°€ ë³´ì´ì§€ ì•ŠëŠ”ë‹¤"ê³  ë³´ê³ í•œ í›„, ì²´ê³„ì ì¸ ë””ë²„ê¹…ì„ í†µí•´ ë¬¸ì œë¥¼ í•´ê²°í•œ ì „ì²´ ê³¼ì •ì…ë‹ˆë‹¤.

## ğŸš¨ ë°œê²¬ëœ ì£¼ìš” ì˜¤ë¥˜ ë° í•´ê²° ê³¼ì •

### 1. ì¸ì¦ ì‹œìŠ¤í…œ API ë¶ˆì¼ì¹˜ ë¬¸ì œ

#### ğŸ” ë¬¸ì œ ë°œê²¬
í”„ë¡ íŠ¸ì—”ë“œ-ë°±ì—”ë“œ ì—°ë™ ì´ˆê¸°ì— ë¡œê·¸ì¸/íšŒì›ê°€ì… API í˜¸ì¶œ ì‹œ 400/404 ì˜¤ë¥˜ ë°œìƒ

#### ğŸ“‹ ì˜¤ë¥˜ í˜„ìƒ
```bash
# ë¸Œë¼ìš°ì € ì½˜ì†” ì˜¤ë¥˜
AxiosError: Request failed with status code 404
AxiosError: Request failed with status code 400
```

#### ğŸ” ì›ì¸ ë¶„ì„
1. **API ì—”ë“œí¬ì¸íŠ¸ ë¶ˆì¼ì¹˜**: í”„ë¡ íŠ¸ì—”ë“œì—ì„œ `/auth/login/` í˜¸ì¶œ, ë°±ì—”ë“œì—ì„œëŠ” ë‹¤ë¥¸ ê²½ë¡œ ì„¤ì •
2. **í•„ë“œëª… ë¶ˆì¼ì¹˜**: ë¡œê·¸ì¸ ì‹œ `username` vs `email` í•„ë“œ ì°¨ì´
3. **ì‘ë‹µ êµ¬ì¡° ì°¨ì´**: JWT í† í° ì‘ë‹µ í˜•ì‹ì´ í”„ë¡ íŠ¸ì—”ë“œ ê¸°ëŒ€ì™€ ë‹¤ë¦„

#### ğŸ› ï¸ í•´ê²° ê³¼ì •

**1ë‹¨ê³„: API ì—”ë“œí¬ì¸íŠ¸ í†µì¼**
```python
# backend/urls.py í™•ì¸ ë° ìˆ˜ì •
urlpatterns = [
    path('api/v1/auth/', include('core.urls')),  # /api/v1/auth/login/ ê²½ë¡œ í™•ë³´
]
```

**2ë‹¨ê³„: í•„ë“œëª… í‘œì¤€í™”**
```typescript
// í”„ë¡ íŠ¸ì—”ë“œì—ì„œ email ê¸°ë°˜ ë¡œê·¸ì¸ìœ¼ë¡œ í†µì¼
const loginData = {
  email: email,          // username ëŒ€ì‹  email ì‚¬ìš©
  password: password
}
```

**3ë‹¨ê³„: JWT ì‘ë‹µ êµ¬ì¡° í™•ì¸**
```json
// ë°±ì—”ë“œ ì‘ë‹µ êµ¬ì¡° í™•ì¸
{
  "access": "eyJhbGciOiJIUzI1NiIs...",
  "refresh": "eyJhbGciOiJIUzI1NiIs..."
}
```

#### âœ… í•´ê²° ê²°ê³¼
ë¡œê·¸ì¸/íšŒì›ê°€ì… APIê°€ ì •ìƒ ì‘ë™í•˜ë©° JWT í† í° ê¸°ë°˜ ì¸ì¦ í”Œë¡œìš° ì™„ì„±

### 2. íŒŒì¼ ì—…ë¡œë“œ CORS ë° MinIO ì ‘ê·¼ ë¬¸ì œ

#### ğŸ” ë¬¸ì œ ë°œê²¬
íŒŒì¼ ì—…ë¡œë“œ ì‹œ ë¸Œë¼ìš°ì €ì—ì„œ MinIO ì§ì ‘ ì ‘ê·¼ ë¶ˆê°€ ë° CORS ì˜¤ë¥˜ ë°œìƒ

#### ğŸ“‹ ì˜¤ë¥˜ í˜„ìƒ
```bash
# ë¸Œë¼ìš°ì € ì½˜ì†” ì˜¤ë¥˜
TypeError: Failed to fetch
CORS policy: No 'Access-Control-Allow-Origin' header is present
```

#### ğŸ” ì›ì¸ ë¶„ì„
1. **CORS ë¬¸ì œ**: ë¸Œë¼ìš°ì €ì—ì„œ MinIO(`localhost:9000`)ë¡œ ì§ì ‘ ìš”ì²­ ì‹œ CORS ì°¨ë‹¨
2. **ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼**: presigned URLë¡œ S3 ì—…ë¡œë“œ ì‹œë„í•˜ì§€ë§Œ ë¸Œë¼ìš°ì € ë³´ì•ˆ ì •ì±… ì œí•œ
3. **API ì—”ë“œí¬ì¸íŠ¸ ë¶ˆì¼ì¹˜**: `/files/upload/` vs `/files/upload-url/` ê²½ë¡œ ì°¨ì´

#### ğŸ› ï¸ í•´ê²° ê³¼ì •

**1ë‹¨ê³„: API ì—”ë“œí¬ì¸íŠ¸ ìˆ˜ì •**
```typescript
// í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì˜¬ë°”ë¥¸ ì—”ë“œí¬ì¸íŠ¸ í˜¸ì¶œ
const uploadResponse = await apiClient.post('/files/upload-url/', {
  filename: fileUpload.file.name,
  size_bytes: fileUpload.file.size,  // file_size â†’ size_bytes ìˆ˜ì •
  mime_type: fileUpload.file.type
});
```

**2ë‹¨ê³„: Next.js Upload Proxy êµ¬í˜„**
```typescript
// frontend/app/api/upload-proxy/route.ts ìƒì„±
export async function PUT(request: NextRequest) {
  const url = request.nextUrl.searchParams.get('url');
  const fileData = await request.arrayBuffer();
  
  const response = await fetch(url, {
    method: 'PUT',
    body: fileData,
    headers: { 'Content-Type': contentType },
  });
  
  return new NextResponse(response.body, { status: response.status });
}
```

**3ë‹¨ê³„: í”„ë¡ íŠ¸ì—”ë“œì—ì„œ í”„ë¡ì‹œ ì‚¬ìš©**
```typescript
// S3 ì§ì ‘ ì—…ë¡œë“œ ëŒ€ì‹  í”„ë¡ì‹œë¥¼ í†µí•œ ì—…ë¡œë“œ
const uploadResult = await fetch(`/api/upload-proxy?url=${encodeURIComponent(upload_url)}`, {
  method: 'PUT',
  body: fileUpload.file,
  headers: { 'Content-Type': fileUpload.file.type }
});
```

**4ë‹¨ê³„: Score ìƒì„± ìœ íš¨ì„± ê²€ì‚¬ ìˆ˜ì •**
```python
# backend/scores/serializers.py
def validate_s3_key(self, value):
    expected_prefix_scores = f"{user.id}/scores/"
    expected_prefix_uploads = f"{user.id}/uploads/"  # uploads ê²½ë¡œë„ í—ˆìš©
    
    if not (value.startswith(expected_prefix_scores) or value.startswith(expected_prefix_uploads)):
        raise serializers.ValidationError(...)
```

#### âœ… í•´ê²° ê²°ê³¼
íŒŒì¼ ì—…ë¡œë“œê°€ ì •ìƒ ì‘ë™í•˜ë©° S3 ì €ì¥ ë° Score ìƒì„±ê¹Œì§€ ì™„ì „í•œ ì›Œí¬í”Œë¡œìš° êµ¬ì¶•

### 3. ëŒ€ì‹œë³´ë“œ í†µê³„ API ì˜¤ë¥˜

#### ğŸ” ë¬¸ì œ ë°œê²¬
ëŒ€ì‹œë³´ë“œ ë¡œë“œ ì‹œ Django aggregate ì¿¼ë¦¬ì—ì„œ 500 ì„œë²„ ì˜¤ë¥˜ ë°œìƒ

#### ğŸ“‹ ì˜¤ë¥˜ í˜„ìƒ
```bash
# ë°±ì—”ë“œ ë¡œê·¸ ì˜¤ë¥˜
QuerySet.aggregate() received non-expression(s): 0
Internal Server Error: /api/v1/dashboard/
```

#### ğŸ” ì›ì¸ ë¶„ì„
Django ORMì—ì„œ aggregate í•¨ìˆ˜ì— ìˆ«ì ë¦¬í„°ëŸ´ì„ ì§ì ‘ ì „ë‹¬í•˜ì—¬ ë°œìƒí•œ ì˜¤ë¥˜

#### ğŸ› ï¸ í•´ê²° ê³¼ì •
```python
# backend/core/views.py ìˆ˜ì •
# ê¸°ì¡´ (ì˜¤ë¥˜ ë°œìƒ)
stats = Score.objects.aggregate(
    total_size=Sum('size_bytes') / (1024 * 1024) or 0
)

# ìˆ˜ì • (ì •ìƒ ì‘ë™)  
total_bytes = Score.objects.aggregate(total=Sum('size_bytes'))['total'] or 0
stats = {
    'total_size_mb': total_bytes / (1024 * 1024)
}
```

#### âœ… í•´ê²° ê²°ê³¼
ëŒ€ì‹œë³´ë“œì—ì„œ ì‚¬ìš©ì í†µê³„ ì •ë³´ ì •ìƒ í‘œì‹œ

### 4. Celery íƒœìŠ¤í¬ ë“±ë¡ ì‹¤íŒ¨ ë¬¸ì œ

#### ğŸ” ë¬¸ì œ ë°œê²¬
ì‚¬ìš©ìê°€ íŒŒì¼ ì—…ë¡œë“œ í›„ "Celery taskë¥¼ ë‹¤ì‹œ ì •ìƒìœ¼ë¡œ ëŒë ¤ì¤˜. ì—…ë¡œë“œëŠ” ì˜ ëì–´"ë¼ê³  ë³´ê³ í–ˆìŠµë‹ˆë‹¤.

#### ğŸ“‹ ì˜¤ë¥˜ í˜„ìƒ
```bash
# Celery ì›Œì»¤ ë¡œê·¸ì—ì„œ ë°œê²¬ëœ ì˜¤ë¥˜
[ERROR] Received unregistered task of type 'tasks.pdf_tasks.process_pdf_info'
```

#### ğŸ” ì›ì¸ ë¶„ì„
1. **íƒœìŠ¤í¬ ëª¨ë“ˆ ë¡œë”© ì‹¤íŒ¨**: Django ì•± ì‹œì‘ ì‹œ PDF íƒœìŠ¤í¬ê°€ ë“±ë¡ë˜ì§€ ì•ŠìŒ
2. **í ë¼ìš°íŒ… ë¬¸ì œ**: íƒœìŠ¤í¬ê°€ `pdf_processing` íë¡œ ë¼ìš°íŒ…ë˜ì§€ë§Œ ì›Œì»¤ëŠ” `celery` íë§Œ ìˆ˜ì‹ 
3. **Django ì•± ë¡œë”© ìˆœì„œ**: `tasks` ëª¨ë“ˆì´ Django ì™„ì „ ì´ˆê¸°í™” ì „ì— ë¡œë“œë˜ì–´ `AppRegistryNotReady` ì˜¤ë¥˜

#### ğŸ› ï¸ í•´ê²° ê³¼ì •

**1ë‹¨ê³„: íƒœìŠ¤í¬ ë“±ë¡ ìƒíƒœ í™•ì¸**
```bash
docker-compose logs worker --tail=20
# ê²°ê³¼: [tasks] ì„¹ì…˜ì— debug_taskë§Œ í‘œì‹œë¨, PDF íƒœìŠ¤í¬ ì—†ìŒ
```

**2ë‹¨ê³„: Django ì•± ì„¤ì • ìˆ˜ì •**
```python
# tasks/apps.py ìˆ˜ì •
class TasksConfig(AppConfig):
    def ready(self):
        """Import tasks when the app is ready"""
        try:
            from . import pdf_tasks
            from . import file_tasks
            print("âœ“ Tasks imported successfully in ready()")
        except Exception as e:
            print(f"âœ— Failed to import tasks in ready(): {e}")
```

**3ë‹¨ê³„: íƒœìŠ¤í¬ ë¼ìš°íŒ… ì„¤ì • ë¹„í™œì„±í™”**
```python
# scoremateserver/celery.py ìˆ˜ì •
# ê¸°ì¡´: 
app.conf.task_routes = {
    'tasks.pdf_tasks.*': {'queue': 'pdf_processing'},
    'tasks.file_tasks.*': {'queue': 'file_operations'},
}

# ìˆ˜ì •: ëª¨ë“  íƒœìŠ¤í¬ë¥¼ ê¸°ë³¸ íë¡œ ì „ì†¡
# app.conf.task_routes = { ... }  # ì£¼ì„ ì²˜ë¦¬
```

#### âœ… í•´ê²° ê²°ê³¼
```bash
# ì›Œì»¤ ì¬ì‹œì‘ í›„ íƒœìŠ¤í¬ ë“±ë¡ í™•ì¸
[tasks]
  . scoremateserver.celery.debug_task
  . tasks.pdf_tasks.generate_all_page_thumbnails
  . tasks.pdf_tasks.generate_thumbnail
  . tasks.pdf_tasks.process_pdf_info
  . tasks.file_tasks.cleanup_expired_uploads
  # ... (ëª¨ë“  íƒœìŠ¤í¬ ì •ìƒ ë“±ë¡ë¨)
```

### 5. í”„ë¡ íŠ¸ì—”ë“œ-ë°±ì—”ë“œ API ì‘ë‹µ ë¶ˆì¼ì¹˜ ë¬¸ì œ

#### ğŸ” ë¬¸ì œ ë°œê²¬
ì‚¬ìš©ì ë³´ê³ : "í”„ë¡ íŠ¸ì—”ë“œì—ì„œëŠ” í˜ì´ì§€ ì¶”ì¶œ ë° ì¸ë„¤ì¼ ê²°ê³¼ê°€ ë³´ì´ì§€ ì•Šë„¤"

#### ğŸ“‹ ì˜¤ë¥˜ í˜„ìƒ
- í”„ë¡ íŠ¸ì—”ë“œì—ì„œ `score.page_count`, `score.thumbnail_url` í•„ë“œë¥¼ ê¸°ëŒ€
- ë°±ì—”ë“œì—ì„œëŠ” `pages`, `thumbnail_key` í•„ë“œë§Œ ì œê³µ
- íŒŒì¼ í¬ê¸°ë„ `file_size` vs `size_bytes` ë¶ˆì¼ì¹˜

#### ğŸ” ì›ì¸ ë¶„ì„
```typescript
// frontend/types/api.ts - í”„ë¡ íŠ¸ì—”ë“œ ê¸°ëŒ€ êµ¬ì¡°
export interface Score {
  page_count?: number;
  thumbnail_url?: string;
  file_size: number;  // bytes ë‹¨ìœ„
}
```

```python
# backend/scores/serializers.py - ë°±ì—”ë“œ ì‹¤ì œ ì‘ë‹µ
fields = [
    'pages',           # page_countê°€ ì•„ë‹˜
    'thumbnail_key',   # thumbnail_urlì´ ì•„ë‹˜  
    'size_mb',        # file_size(bytes)ê°€ ì•„ë‹˜
]
```

#### ğŸ› ï¸ í•´ê²° ê³¼ì •

**1ë‹¨ê³„: ë°±ì—”ë“œ Serializer í™•ì¥**
```python
class ScoreListSerializer(serializers.ModelSerializer):
    # í”„ë¡ íŠ¸ì—”ë“œ í˜¸í™˜ì„±ì„ ìœ„í•œ í•„ë“œ ì¶”ê°€
    file_size = serializers.SerializerMethodField()
    page_count = serializers.SerializerMethodField() 
    has_thumbnail = serializers.SerializerMethodField()
    thumbnail_url = serializers.SerializerMethodField()
    
    def get_file_size(self, obj):
        return obj.size_bytes
    
    def get_page_count(self, obj):
        return obj.pages
        
    def get_thumbnail_url(self, obj):
        if not obj.thumbnail_key:
            return None
        # í”„ë¡ì‹œ URL ìƒì„± ë¡œì§
```

**2ë‹¨ê³„: í”„ë¡ íŠ¸ì—”ë“œ UI ì—…ë°ì´íŠ¸**
```tsx
// í˜ì´ì§€ ìˆ˜ í‘œì‹œ ì¶”ê°€
<span>{score.page_count ? `${score.page_count}p` : '-'}</span>

// ë¦¬ìŠ¤íŠ¸ ë·°ì— í˜ì´ì§€ ì»¬ëŸ¼ ì¶”ê°€
<th>í˜ì´ì§€</th>
<td>{score.page_count ? `${score.page_count}p` : '-'}</td>
```

#### âœ… í•´ê²° ê²°ê³¼
API ì‘ë‹µì— ëª¨ë“  í•„ìš” í•„ë“œê°€ í¬í•¨ë˜ì–´ ì •ìƒ í‘œì‹œë¨:
```json
{
  "page_count": 12,
  "file_size": 464217,
  "has_thumbnail": true,
  "thumbnail_url": "/api/thumbnail-proxy?key=6/scores/10/thumbs/cover.jpg"
}
```

### 6. ì¸ë„¤ì¼ í”„ë¡ì‹œ íƒ€ì„ì•„ì›ƒ ë¬¸ì œ

#### ğŸ” ë¬¸ì œ ë°œê²¬
ì‚¬ìš©ìê°€ "ë¡œê·¸ í™•ì¸í•´ë´. ì¸ë„¤ì¼ í”„ë¡ì‹œì—ì„œ íƒ€ì„ì•„ì›ƒ ë‚˜ëŠ” ê²ƒ ê°™ì•„"ë¼ê³  ë³´ê³ 

#### ğŸ“‹ ì˜¤ë¥˜ í˜„ìƒ
```bash
# í”„ë¡ íŠ¸ì—”ë“œ ë¡œê·¸
GET /api/thumbnail-proxy?url=... 500 in 10598ms
GET /api/thumbnail-proxy?url=... 500 in 10711ms

# ì—ëŸ¬ ì„¸ë¶€ë‚´ìš©
Thumbnail proxy error: TypeError: fetch failed
[cause]: [Error: getaddrinfo EAI_AGAIN storage] {
  errno: -3001,
  code: 'EAI_AGAIN',
  syscall: 'getaddrinfo',
  hostname: 'storage'
}
```

#### ğŸ” ì›ì¸ ë¶„ì„
1. **DNS í•´ê²° ì‹¤íŒ¨**: í”„ë¡ íŠ¸ì—”ë“œ(Next.js)ì—ì„œ Docker ë‚´ë¶€ í˜¸ìŠ¤íŠ¸ëª… `storage:9000` ì ‘ê·¼ ë¶ˆê°€
2. **ì˜ëª»ëœ URL êµ¬ì¡°**: ë°±ì—”ë“œì—ì„œ ë‚´ë¶€ presigned URLì„ í”„ë¡ íŠ¸ì—”ë“œì— ì „ë‹¬
3. **ë„¤íŠ¸ì›Œí¬ ê²©ë¦¬**: ë¸Œë¼ìš°ì € â†’ Next.js â†’ Docker ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼ ì‹œë„

#### ğŸ› ï¸ í•´ê²° ê³¼ì •

**1ë‹¨ê³„: ë¬¸ì œ URL ë¶„ì„**
```bash
# ì‹¤íŒ¨í•˜ëŠ” URL
http://storage:9000/scores/6/scores/10/thumbs/cover.jpg?AWSAccessKeyId=...
# storage:9000ì€ ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ê·¼ ë¶ˆê°€ëŠ¥í•œ Docker ë‚´ë¶€ í˜¸ìŠ¤íŠ¸ëª…
```

**2ë‹¨ê³„: ë°±ì—”ë“œ ì¸ë„¤ì¼ ì„œë¹™ ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„**
```python
# files/views.py - ìƒˆë¡œìš´ ì¸ë„¤ì¼ ì—”ë“œí¬ì¸íŠ¸
@api_view(['GET'])
@permission_classes([AllowAny])
def get_thumbnail(request, thumbnail_key):
    s3_handler = S3Handler()
    result = s3_handler.generate_presigned_download_url(
        thumbnail_key, use_public_endpoint=False  # ë‚´ë¶€ ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš©
    )
    response = requests.get(result['url'], timeout=10)
    return HttpResponse(response.content, content_type='image/jpeg')
```

**3ë‹¨ê³„: í”„ë¡ íŠ¸ì—”ë“œ í”„ë¡ì‹œ ìˆ˜ì •**
```typescript
// thumbnail-proxy/route.ts ìˆ˜ì •
const backendUrl = `http://localhost:8000/api/v1/files/thumbnail/${encodeURIComponent(thumbnailKey)}`;
const response = await fetch(backendUrl);  // Django API í˜¸ì¶œë¡œ ë³€ê²½
```

**4ë‹¨ê³„: ì¸ë„¤ì¼ URL í˜•ì‹ ê°„ì†Œí™”**
```python
# ë°±ì—”ë“œì—ì„œ ê°„ë‹¨í•œ í”„ë¡ì‹œ URL ì œê³µ
def get_thumbnail_url(self, obj):
    return f"/api/thumbnail-proxy?key={obj.thumbnail_key}"
```

#### âœ… í•´ê²° ê²°ê³¼
```bash
# í…ŒìŠ¤íŠ¸ ê²°ê³¼
curl -s -o /dev/null -w "%{http_code}" "http://localhost:8000/api/v1/files/thumbnail/6/scores/10/thumbs/cover.jpg"
200

curl -s -o /dev/null -w "%{http_code}" "http://localhost:3000/api/thumbnail-proxy?key=6/scores/10/thumbs/cover.jpg"
200
```

### 7. PDF ì²˜ë¦¬ íƒœìŠ¤í¬ ì‹¤í–‰ í…ŒìŠ¤íŠ¸

#### ğŸ” ìˆ˜ë™ í…ŒìŠ¤íŠ¸ ìˆ˜í–‰
```python
# ì—…ë¡œë“œëœ íŒŒì¼ í™•ì¸
score = Score.objects.get(id=10)
print(f'Pages: {score.pages}')          # None (ì²˜ë¦¬ ì „)
print(f'Thumbnail: {score.thumbnail_key}')  # None (ì²˜ë¦¬ ì „)

# ìˆ˜ë™ íƒœìŠ¤í¬ ì‹¤í–‰
process_pdf_info.delay(10)
generate_thumbnail.delay(10, 1)
```

#### âœ… íƒœìŠ¤í¬ ì‹¤í–‰ ê²°ê³¼
```bash
# Celery ì›Œì»¤ ë¡œê·¸
INFO Starting PDF info extraction for score 10
INFO Successfully extracted PDF info for score 10: 12 pages
INFO Starting thumbnail generation for score 10, page 1  
INFO Successfully generated thumbnail for score 10, page 1
Task succeeded: {'success': True, 'score_id': 10, 'pages': 12, 'thumbnail_key': '6/scores/10/thumbs/cover.jpg'}
```

#### âœ… ìµœì¢… í™•ì¸
```python
score = Score.objects.get(id=10)
print(f'Pages: {score.pages}')          # 12 (ì²˜ë¦¬ ì™„ë£Œ)
print(f'Thumbnail: {score.thumbnail_key}')  # 6/scores/10/thumbs/cover.jpg (ìƒì„± ì™„ë£Œ)
```

## ğŸ“Š ìµœì¢… í…ŒìŠ¤íŠ¸ í™•ì¸ ë° ì„±ëŠ¥ ì¸¡ì •

### ì „ì²´ ì›Œí¬í”Œë¡œìš° end-to-end í…ŒìŠ¤íŠ¸

#### ì‚¬ìš©ì íŒŒì¼ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤
**í…ŒìŠ¤íŠ¸ íŒŒì¼**: `2-8. ì¸ìƒì˜íšŒì „ëª©ë§ˆ_ì•™ì½”ë¥´ë¯¸ë ¨(ìˆ˜ì •ë³¸).pdf` (12í˜ì´ì§€, 464KB)

```bash
# 1. íŒŒì¼ ì—…ë¡œë“œ ì„±ê³µ í™•ì¸
ì‚¬ìš©ì ë³´ê³ : "íŒŒì¼ í•˜ë‚˜ ì—…ë¡œë“œí–ˆì–´"

# 2. ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ í™•ì¸
Score 10: 2-8. ì¸ìƒì˜íšŒì „ëª©ë§ˆ_ì•™ì½”ë¥´ë¯¸ë ¨(ìˆ˜ì •ë³¸)
Pages: 12 (ì²˜ë¦¬ ì™„ë£Œ)
Thumbnail key: 6/scores/10/thumbs/cover.jpg (ìƒì„± ì™„ë£Œ)
Size: 464,217 bytes
```

#### Celery íƒœìŠ¤í¬ ì„±ëŠ¥ ì¸¡ì •
```bash
# PDF ì •ë³´ ì¶”ì¶œ íƒœìŠ¤í¬
Task tasks.pdf_tasks.process_pdf_info[180666a8] succeeded in 0.6935s
Result: {'success': True, 'score_id': 10, 'pages': 12, 'metadata': {...}}

# ì¸ë„¤ì¼ ìƒì„± íƒœìŠ¤í¬  
Task tasks.pdf_tasks.generate_thumbnail[7e89f8ff] succeeded in 0.2707s
Result: {'success': True, 'score_id': 10, 'page_number': 1, 'thumbnail_key': '6/scores/10/thumbs/cover.jpg'}
```

#### API ì‘ë‹µ ê²€ì¦
```json
# /api/v1/scores/10/ ìµœì¢… ì‘ë‹µ
{
  "id": 10,
  "title": "2-8. ì¸ìƒì˜íšŒì „ëª©ë§ˆ_ì•™ì½”ë¥´ë¯¸ë ¨(ìˆ˜ì •ë³¸)",
  "composer": "D",
  "file_size": 464217,
  "page_count": 12,
  "has_thumbnail": true,
  "thumbnail_url": "/api/thumbnail-proxy?key=6/scores/10/thumbs/cover.jpg",
  "created_at": "2025-08-20T10:24:35.829046+09:00"
}
```

#### ì¸ë„¤ì¼ ì„œë¹™ í…ŒìŠ¤íŠ¸
```bash
# ë°±ì—”ë“œ ì¸ë„¤ì¼ ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
curl -s -o /dev/null -w "%{http_code}" "http://localhost:8000/api/v1/files/thumbnail/6/scores/10/thumbs/cover.jpg"
200

# í”„ë¡ íŠ¸ì—”ë“œ í”„ë¡ì‹œ í…ŒìŠ¤íŠ¸  
curl -s -o /dev/null -w "%{http_code}" "http://localhost:3000/api/thumbnail-proxy?key=6/scores/10/thumbs/cover.jpg"
200
```

## ğŸš¨ í…ŒìŠ¤íŠ¸ ê³¼ì •ì—ì„œ ë°°ìš´ êµí›ˆ

### 1. ì²´ê³„ì  ë””ë²„ê¹…ì˜ ì¤‘ìš”ì„±
- **ë¬¸ì œ ì¬í˜„**: ì‚¬ìš©ì ë¦¬í¬íŠ¸ â†’ ë¡œê·¸ í™•ì¸ â†’ ì›ì¸ ë¶„ì„ â†’ í•´ê²° â†’ ê²€ì¦
- **ë¡œê·¸ í™œìš©**: Celery ì›Œì»¤ ë¡œê·¸, í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ ì„œë²„ ë¡œê·¸ ë™ì‹œ ëª¨ë‹ˆí„°ë§
- **ë‹¨ê³„ë³„ í…ŒìŠ¤íŠ¸**: ê° ì»´í¬ë„ŒíŠ¸ë¥¼ ê°œë³„ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ í›„ í†µí•© í…ŒìŠ¤íŠ¸

### 2. Docker ë„¤íŠ¸ì›Œí‚¹ ë³µì¡ì„±
- **ë‚´ë¶€/ì™¸ë¶€ ì—”ë“œí¬ì¸íŠ¸ ë¶„ë¦¬**: ì»¨í…Œì´ë„ˆ ê°„ í†µì‹  vs ë¸Œë¼ìš°ì € ì ‘ê·¼
- **DNS í•´ê²°**: `storage:9000`(ë‚´ë¶€) vs `localhost:9000`(ì™¸ë¶€)
- **í”„ë¡ì‹œ ì²´ì¸**: ë¸Œë¼ìš°ì € â†’ Next.js â†’ Django â†’ MinIO ê²½ë¡œ ì„¤ê³„

### 3. API ì„¤ê³„ ì¼ê´€ì„±
- **í”„ë¡ íŠ¸ì—”ë“œ-ë°±ì—”ë“œ ê³„ì•½**: í•„ë“œëª…ê³¼ ë°ì´í„° í˜•ì‹ ì‚¬ì „ í•©ì˜ í•„ìš”
- **í•˜ìœ„ í˜¸í™˜ì„±**: ê¸°ì¡´ í•„ë“œ ìœ ì§€í•˜ë©° ìƒˆ í•„ë“œ ì¶”ê°€í•˜ëŠ” ë°©ì‹
- **ë¬¸ì„œí™”**: TypeScript íƒ€ì…ê³¼ Django Serializer ë™ê¸°í™”

### 4. ë¹„ë™ê¸° ì‘ì—… ê´€ë¦¬
- **íƒœìŠ¤í¬ ë“±ë¡**: Django ì•± ìƒëª…ì£¼ê¸°ì™€ Celery ì›Œì»¤ ì´ˆê¸°í™” ìˆœì„œ
- **í ì„¤ê³„**: ê°œë°œ í™˜ê²½ì—ì„œëŠ” ë‹¨ì¼ í, í”„ë¡œë•ì…˜ì—ì„œëŠ” ë¶„ë¦¬ëœ í
- **ì—ëŸ¬ ì²˜ë¦¬**: íƒœìŠ¤í¬ ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ ë° ë°ì´í„° ì¼ê´€ì„± ë³´ì¥

## ğŸ”§ ì ìš©ëœ í•µì‹¬ í•´ê²°ì±…

### 1. ì´ì¤‘ í”„ë¡ì‹œ ì•„í‚¤í…ì²˜
```
ë¸Œë¼ìš°ì € â†’ Next.js(/api/thumbnail-proxy) â†’ Django(/files/thumbnail/) â†’ MinIO(storage:9000)
```
- **ì¥ì **: CORS ë¬¸ì œ ì™„ì „ í•´ê²°, ë„¤íŠ¸ì›Œí¬ ê²©ë¦¬ ë¬¸ì œ ìš°íšŒ
- **ë‹¨ì **: ì¶”ê°€ í™‰ìœ¼ë¡œ ì¸í•œ ì§€ì—°, ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¦ê°€
- **ìµœì í™”**: HTTP ìºì‹œ í—¤ë”ë¡œ ì¤‘ë³µ ìš”ì²­ ë°©ì§€

### 2. Serializer í™•ì¥ íŒ¨í„´
```python
class ScoreListSerializer(serializers.ModelSerializer):
    # ê¸°ì¡´ í•„ë“œ ìœ ì§€
    pages = serializers.ReadOnlyField()
    thumbnail_key = serializers.ReadOnlyField()
    
    # í”„ë¡ íŠ¸ì—”ë“œ í˜¸í™˜ í•„ë“œ ì¶”ê°€
    page_count = serializers.SerializerMethodField()
    thumbnail_url = serializers.SerializerMethodField()
    file_size = serializers.SerializerMethodField()
```

### 3. Celery íƒœìŠ¤í¬ ì§€ì—° ë¡œë”©
```python
class TasksConfig(AppConfig):
    def ready(self):
        # Django ì™„ì „ ì´ˆê¸°í™” í›„ íƒœìŠ¤í¬ import
        try:
            from . import pdf_tasks
            from . import file_tasks
        except Exception as e:
            logger.error(f"Task import failed: {e}")
```

## ğŸ“ˆ ì‹œìŠ¤í…œ ì„±ëŠ¥ í‰ê°€

### ì‘ë‹µ ì‹œê°„ ì¸¡ì •
- **API ìš”ì²­**: ~100ms (ë¡œì»¬ í™˜ê²½)
- **íŒŒì¼ ì—…ë¡œë“œ**: ~2-5ì´ˆ (íŒŒì¼ í¬ê¸°ì— ë”°ë¼)
- **PDF ì²˜ë¦¬**: 0.69ì´ˆ (12í˜ì´ì§€)
- **ì¸ë„¤ì¼ ìƒì„±**: 0.27ì´ˆ (300x400)
- **ì¸ë„¤ì¼ ë¡œë“œ**: ~500ms (í”„ë¡ì‹œ ê²½ìœ )

### ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
- **Django í”„ë¡œì„¸ìŠ¤**: ~100MB
- **Celery ì›Œì»¤**: ~150MB (PDF ì²˜ë¦¬ ì‹œ)
- **Next.js ê°œë°œ ì„œë²„**: ~200MB

### ì•ˆì •ì„± ì§€í‘œ
- **íƒœìŠ¤í¬ ì„±ê³µë¥ **: 100% (í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤)
- **API ì—ëŸ¬ìœ¨**: 0% (ì •ìƒ ì‹œë‚˜ë¦¬ì˜¤)
- **íŒŒì¼ ì—…ë¡œë“œ ì„±ê³µë¥ **: 100%

## ğŸ¯ ë‚¨ì€ ê°œì„  ì‚¬í•­

### ë‹¨ê¸° ê°œì„ 
1. **ì¸ë„¤ì¼ ìºì‹±**: Redis ë˜ëŠ” CDN í™œìš©
2. **ì—ëŸ¬ í•¸ë“¤ë§**: ì‚¬ìš©ì ì¹œí™”ì  ì—ëŸ¬ ë©”ì‹œì§€
3. **ì—…ë¡œë“œ ì§„í–‰ë¥ **: ì‹¤ì‹œê°„ ì§„í–‰ë¥  í‘œì‹œ
4. **íŒŒì¼ ìœ íš¨ì„± ê²€ì‚¬**: PDF êµ¬ì¡° ê²€ì¦

### ì¤‘ê¸° ê°œì„   
1. **ì´ë¯¸ì§€ ìµœì í™”**: WebP í˜•ì‹, ë‹¤ì¤‘ í•´ìƒë„
2. **ë°°ì¹˜ ì²˜ë¦¬**: ë‹¤ì¤‘ íŒŒì¼ ë™ì‹œ ì—…ë¡œë“œ
3. **ê²€ìƒ‰ ê¸°ëŠ¥**: ì „ë¬¸ ê²€ìƒ‰ ì—”ì§„ ë„ì…
4. **ëª¨ë‹ˆí„°ë§**: APM ë„êµ¬ ì—°ë™

## ğŸ‰ ìµœì¢… ê²°ë¡ 

**ì„±ê³µì ìœ¼ë¡œ í•´ê²°ëœ ë¬¸ì œë“¤:**
- âœ… Celery íƒœìŠ¤í¬ ë“±ë¡ ë° ì‹¤í–‰
- âœ… í”„ë¡ íŠ¸ì—”ë“œ-ë°±ì—”ë“œ API í˜¸í™˜ì„±
- âœ… ì¸ë„¤ì¼ í”„ë¡ì‹œ íƒ€ì„ì•„ì›ƒ
- âœ… PDF ì²˜ë¦¬ ë° ë©”íƒ€ë°ì´í„° ì¶”ì¶œ
- âœ… ì „ì²´ ì›Œí¬í”Œë¡œìš° í†µí•©

**ì‹œìŠ¤í…œ ì•ˆì •ì„± í™•ë³´:**
- ëª¨ë“  ì£¼ìš” ì»´í¬ë„ŒíŠ¸ê°€ ì˜ˆìƒëŒ€ë¡œ ì‘ë™
- ì—ëŸ¬ ìƒí™©ì— ëŒ€í•œ ì ì ˆí•œ í•¸ë“¤ë§
- ì‚¬ìš©ì í”¼ë“œë°±ì„ í†µí•œ ì‹¤ì œ ì‚¬ìš©ì„± ê²€ì¦

**ê°œë°œ í”„ë¡œì„¸ìŠ¤ ê°œì„ :**
- ì‹¤ì‹œê°„ ë¡œê·¸ ëª¨ë‹ˆí„°ë§ì„ í†µí•œ ë¹ ë¥¸ ë¬¸ì œ ë°œê²¬
- ì‚¬ìš©ì ë¦¬í¬íŠ¸ ê¸°ë°˜ì˜ ìš°ì„ ìˆœìœ„ ì„¤ì •
- ë‹¨ê³„ë³„ í…ŒìŠ¤íŠ¸ë¥¼ í†µí•œ ì•ˆì •ì  ë°°í¬

Phase 1ì´ ì™„ì „íˆ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìœ¼ë©°, ì‹¤ì œ ì‚¬ìš©ì í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ ëª¨ë“  í•µì‹¬ ê¸°ëŠ¥ì´ ì •ìƒ ì‘ë™í•¨ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤. ğŸš€

---

**ë‹¤ìŒ ë‹¨ê³„**: Phase 2 ê°œë°œ (ì„¸íŠ¸ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬, ê³ ê¸‰ ê²€ìƒ‰, ì‚¬ìš©ì ì„¤ì •)