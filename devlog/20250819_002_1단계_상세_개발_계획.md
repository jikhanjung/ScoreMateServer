### 1단계: Django 프로젝트 초기화 및 핵심 모델 구현 - 상세 개발 계획

#### 1. Django 프로젝트 생성 및 기본 설정
*   **프로젝트 생성**:
    *   `web` 서비스 컨테이너 내부에서 Django 프로젝트를 생성합니다.
    *   `django-admin startproject scoremateserver .` (현재 디렉토리에 프로젝트 생성)
*   **기본 설정 (`scoremateserver/settings.py`)**:
    *   `ALLOWED_HOSTS` 설정 (개발 환경에서는 `*` 허용)
    *   `INSTALLED_APPS`에 기본 Django 앱 및 향후 생성할 커스텀 앱 (`core`, `scores`, `setlists`, `files`, `tasks`, `admin`) 추가
    *   `DATABASES` 설정: `ARCHITECTURE.md`의 `DATABASE_URL` 환경 변수를 사용하여 PostgreSQL 연결 설정
    *   `TIME_ZONE`, `USE_TZ` 설정 (Asia/Seoul)
    *   `STATIC_URL` 및 `STATICFILES_DIRS` 설정 (선택 사항, 추후 필요 시)
    *   `MEDIA_URL` 및 `MEDIA_ROOT` 설정 (파일 업로드 관련, 추후 필요 시)

#### 2. 핵심 Django 앱 생성
*   `python manage.py startapp core`
*   `python manage.py startapp scores`
*   `python manage.py startapp setlists`
*   `python manage.py startapp files`
*   `python manage.py startapp tasks`
*   `python manage.py startapp admin` (선택 사항, `admin.py` 파일만 관리할 경우 앱으로 만들지 않아도 됨)
*   생성된 앱들을 `settings.py`의 `INSTALLED_APPS`에 추가합니다.

#### 3. 데이터 모델 정의 (`models.py`)

`ARCHITECTURE.md`의 `Data Model` 섹션을 기반으로 각 앱의 `models.py`에 다음 모델들을 정의합니다.

*   **`core/models.py`**:
    *   **User**:
        *   `id` (기본 키)
        *   `email` (고유, 이메일 필드)
        *   `password_hash` (비밀번호 해시)
        *   `plan` (사용자 플랜, 예: `CharField` 또는 `ForeignKey` to `Plan` model)
        *   `total_quota_mb` (총 할당량, `IntegerField`)
        *   `used_quota_mb` (사용량, `IntegerField`)
        *   `referral_code` (추천 코드, `CharField`)
        *   `created_at` (`DateTimeField`, `auto_now_add=True`)
        *   (Django `AbstractUser` 또는 `AbstractBaseUser`를 상속받아 사용자 모델 확장 고려)

*   **`scores/models.py`**:
    *   **Score**:
        *   `id` (기본 키)
        *   `user` (`ForeignKey` to `User` model)
        *   `title` (`CharField`)
        *   `composer` (`CharField`)
        *   `instrumentation` (`CharField`)
        *   `pages` (`IntegerField`)
        *   `s3_key` (`CharField`, S3/MinIO 객체 키)
        *   `size_bytes` (`BigIntegerField`)
        *   `mime` (`CharField`)
        *   `thumbnail_key` (`CharField`, 썸네일 S3/MinIO 객체 키)
        *   `tags` (`ArrayField` of `CharField` 또는 `ManyToManyField` to `Tag` model)
        *   `note` (`TextField`)
        *   `content_hash` (`CharField`, 파일 내용 해시)
        *   `created_at` (`DateTimeField`, `auto_now_add=True`)
        *   `updated_at` (`DateTimeField`, `auto_now=True`)

*   **`setlists/models.py`**:
    *   **Setlist**:
        *   `id` (기본 키)
        *   `user` (`ForeignKey` to `User` model)
        *   `title` (`CharField`)
        *   `description` (`TextField`)
        *   `created_at` (`DateTimeField`, `auto_now_add=True`)
    *   **SetlistItem**:
        *   `id` (기본 키)
        *   `setlist` (`ForeignKey` to `Setlist` model)
        *   `score` (`ForeignKey` to `Score` model)
        *   `order_index` (`IntegerField`)

*   **`tasks/models.py`**:
    *   **Task**:
        *   `id` (기본 키)
        *   `user` (`ForeignKey` to `User` model)
        *   `score` (`ForeignKey` to `Score` model, `null=True`, `blank=True`)
        *   `kind` (`CharField`, `choices` for `pdf_info`, `thumbnail`, `layout_hook`)
        *   `status` (`CharField`, `choices` for `PENDING`, `RUNNING`, `SUCCEEDED`, `FAILED`)
        *   `try_count` (`IntegerField`, `default=0`)
        *   `log` (`TextField`, 작업 로그)
        *   `created_at` (`DateTimeField`, `auto_now_add=True`)
        *   `updated_at` (`DateTimeField`, `auto_now=True`)

*   **`core/models.py` (추가 로깅/빌링 모델)**:
    *   **ReferralLog**:
        *   `id` (기본 키)
        *   `user` (`ForeignKey` to `User` model)
        *   `referred_user` (`ForeignKey` to `User` model, `related_name='referred_by'`)
        *   `bonus_mb` (`IntegerField`)
        *   `created_at` (`DateTimeField`, `auto_now_add=True`)
    *   **BillingLog**:
        *   `id` (기본 키)
        *   `user` (`ForeignKey` to `User` model)
        *   `kind` (`CharField`, `choices` for `plan_change`, `payment`, `refund`, `referral_bonus`)
        *   `amount` (`DecimalField` 또는 `IntegerField`)
        *   `meta_json` (`JSONField`)
        *   `created_at` (`DateTimeField`, `auto_now_add=True`)
    *   **AccessLog**:
        *   `id` (기본 키)
        *   `user` (`ForeignKey` to `User` model)
        *   `action` (`CharField`)
        *   `target_type` (`CharField`)
        *   `target_id` (`IntegerField`)
        *   `meta_json` (`JSONField`)
        *   `created_at` (`DateTimeField`, `auto_now_add=True`)

#### 4. 데이터베이스 마이그레이션 실행
*   각 모델 정의 후, 변경 사항을 데이터베이스 스키마에 반영합니다.
*   `python manage.py makemigrations`
*   `python manage.py migrate`

#### 5. 관리자 계정 생성
*   Django Admin 사이트 접근 및 테스트를 위해 관리자 계정을 생성합니다.
*   `python manage.py createsuperuser`
