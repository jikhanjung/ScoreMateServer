# ScoreMate 서버 MVP 개발 계획

> `ARCHITECTURE.md` 문서를 기반으로 한 초기 개발 계획입니다.

### 0단계: 개발 환경 설정
1.  **디렉토리 구조 생성**: `ARCHITECTURE.md`의 `Directory Layout` 섹션에 따라 `/app`, `/infra`, `/docs` 디렉토리를 생성합니다. `/app` 내부에는 `core`, `scores`, `setlists`, `files`, `tasks`, `admin` Django 앱을 위한 디렉토리를 미리 만듭니다.
2.  **Docker 환경 구성**: `/infra/docker-compose.yml` 파일을 작성하여 `web`(Django), `worker`(Celery), `db`(Postgres), `cache`(Redis), `storage`(MinIO), `proxy`(Nginx) 서비스를 정의합니다.
3.  **.env 파일 준비**: `Key Env Vars` 목록을 바탕으로 `.env.example` 파일을 만들고, 실제 개발에 사용할 `.env` 파일을 생성합니다.
4.  **컨테이너 실행**: `docker compose up -d` 명령어로 모든 서비스 컨테이너를 실행합니다.

### 1단계: Django 프로젝트 초기화 및 핵심 모델 구현
1.  **Django 프로젝트 생성**: `web` 서비스 컨테이너 내에서 Django 프로젝트를 시작합니다.
2.  **데이터 모델 정의**: `Data Model` 섹션을 참고하여 `core`, `scores`, `setlists` 앱의 `models.py` 파일에 **User**, **Score**, **Setlist**, **SetlistItem** 모델을 정의합니다. 초기에는 MVP에 필수적인 핵심 모델부터 구현합니다.
3.  **데이터베이스 마이그레이션**: `python manage.py makemigrations` 및 `migrate`를 실행하여 PostgreSQL 데이터베이스에 테이블을 생성합니다.
4.  **관리자 계정 생성**: `python manage.py createsuperuser`로 관리자 계정을 생성하여 Django Admin을 통해 데이터를 직접 확인할 수 있도록 준비합니다.

### 2단계: 계정/인증(Auth) 및 사용량(Quota) 기능 구현 (MVP 1)
1.  **JWT 인증 설정**: `djangorestframework-simplejwt` 같은 라이브러리를 사용하여 JWT 기반 인증 시스템을 구축합니다.
2.  **API 엔드포인트 구현**: `API Surface`의 `Auth` 섹션에 따라 다음 API를 구현합니다.
    *   `POST /auth/register`: 사용자 생성
    *   `POST /auth/login`: JWT 토큰 발급
3.  **Quota 모델 연동**: `User` 모델에 `total_quota_mb`, `used_quota_mb` 필드를 추가하고, 회원가입 시 기본 Quota를 할당하는 로직을 구현합니다.

### 3단계: 파일 업로드 및 백그라운드 작업 구현 (MVP 2)
1.  **Presigned URL 발급 기능**: `files` 앱에서 `POST /files/upload-url` 엔드포인트를 구현합니다. 이 엔드포인트는 다음을 수행해야 합니다.
    *   요청자의 Quota와 파일의 MIME 타입, 크기를 검증합니다.
    *   S3/MinIO에 업로드할 수 있는 Presigned PUT URL을 생성하여 반환합니다.
2.  **Celery/Redis 연동**: Django 프로젝트에 Celery와 Redis를 연동하여 비동기 작업을 처리할 준비를 합니다.
3.  **백그라운드 작업 정의**: `tasks` 앱에서 `Background Jobs` 섹션에 명시된 작업을 Celery Task로 구현합니다.
    *   `PDF_INFO`: PDF 파일의 페이지 수 등 메타데이터를 읽어 `Score` 모델을 업데이트합니다.
    *   `THUMBNAIL`: PDF 첫 페이지를 이미지로 변환하여 `cover.jpg` 썸네일을 생성하고 S3/MinIO에 저장합니다.
4.  **Score 메타데이터 생성**: `scores` 앱에 `POST /scores` 엔드포인트를 구현합니다. 클라이언트는 파일이 S3에 업로드된 후 이 엔드포인트를 호출하여 `Score` 레코드를 생성하고, 이 때 백그라운드 작업이 트리거되도록 합니다.

### 4단계: 악보(Scores) 및 세트리스트(Setlists) CRUD 구현 (MVP 3)
1.  **Serializer/View 구현**: `scores`와 `setlists` 앱에 DRF의 `ModelViewSet` 등을 사용하여 `API Surface`에 정의된 CRUD 엔드포인트를 모두 구현합니다.
    *   `GET /scores`: 목록 조회 시 썸네일 URL을 포함하여 반환해야 합니다.
    *   `GET /scores/{id}`, `PATCH /scores/{id}`, `DELETE /scores/{id}`
    *   `GET /setlists`, `POST /setlists`, `PATCH /setlists/{id}`, `DELETE /setlists/{id}`
    *   `POST /setlists/{id}/items`: 세트리스트에 악보를 추가/정렬하는 기능

### 5단계: 관리자 페이지(Admin) 및 사용량 경고 구현 (MVP 4, 5)
1.  **Django Admin 커스터마이징**: `admin` 앱에서 주요 모델들(`User`, `Score`, `Task`, `BillingLog` 등)을 등록하여 관리자가 데이터를 쉽게 조회하고 관리할 수 있도록 설정합니다.
2.  **사용량 경고**: 파일 업로드 시 사용자의 Quota 사용량을 체크하여 80%, 95% 등 특정 임계값을 넘었을 때 이를 기록하거나, (MVP 이후) 이메일/웹훅으로 알릴 수 있는 기반을 마련합니다.
