# Phase 4 구현 계획: 고급 뷰어, 검색, 협업

**작성일**: 2025년 8월 21일  
**작성자**: Gemini  
**단계**: Phase 4 - 고급 기능 확장 및 협업 기능 도입

## 1. 개요

Phase 3에서 확보된 안정적인 기반 위에, ScoreMate를 전문적인 악보 관리 및 협업 플랫폼으로 한 단계 더 발전시키기 위한 Phase 4 개발 계획을 수립합니다. 이번 단계에서는 **고급 문서 뷰어 도입**, **검색 기능 강화**, **성능 최적화**, 그리고 **기본적인 협업 기능 구현**에 중점을 둡니다.

## 2. 목표

*   **사용자 경험 혁신**: 인앱(In-app) 전체 PDF 뷰어를 통해 악보 열람 경험을 극대화합니다.
*   **정보 접근성 향상**: 강력한 검색 기능과 필터 저장 기능으로 사용자가 원하는 악보를 더 빠르고 쉽게 찾도록 돕습니다.
*   **애플리케이션 성능 향상**: 대용량 라이브러리에서도 쾌적한 사용성을 제공하기 위해 무한 스크롤을 도입합니다.
*   **협업 기능 기반 마련**: 세트리스트 공유 기능을 통해 사용자들이 함께 작업할 수 있는 환경을 구축합니다.

## 3. 주요 Task 및 세부 구현 계획

### **Task 1: 고급 PDF 뷰어 구현**

**목표**: 현재의 썸네일 미리보기를 대체하여, 페이지 넘김, 확대/축소가 가능한 완전한 기능의 인앱 PDF 뷰어를 제공합니다.

*   **1.1: 라이브러리 선정 및 통합**
    *   `react-pdf`와 `pdf.js`의 기능, 성능, 모바일 지원, 커뮤니티 성숙도를 비교 분석하여 최종 라이브러리를 선정합니다.
    *   선정된 라이브러리를 `frontend` 프로젝트에 설치하고 초기 설정을 완료합니다.

*   **1.2: 백엔드 API 검토 및 지원**
    *   파일 다운로드 API (`/files/download/:id/`)가 대용량 PDF 파일 스트리밍을 안정적으로 지원하는지 확인합니다.
    *   필요 시, 페이지별 로딩 최적화를 위해 특정 페이지의 렌더링 정보를 가져오는 API 지원을 검토합니다.

*   **1.3: 프론트엔드 `PdfViewer` 컴포넌트 개발**
    *   악보 상세 페이지 (`/scores/[id]`)에 통합될 `PdfViewer` 컴포넌트를 새로 개발합니다.
    *   **핵심 기능 구현**:
        *   페이지 이동 (다음/이전, 특정 페이지 입력)
        *   확대/축소 기능
        *   전체 화면 모드 전환
        *   모바일 환경에 최적화된 반응형 디자인 적용
    *   기존 미리보기 모달을 이 `PdfViewer`를 사용하는 상세 페이지로 완전히 대체합니다.

*   **1.4: 테스트**
    *   `PdfViewer` 컴포넌트의 핵심 기능에 대한 단위 테스트를 작성합니다.
    *   Playwright E2E 테스트를 수정하여 새로운 PDF 뷰어의 전체 플로우를 검증합니다.

### **Task 2: 고급 검색 기능 강화**

**목표**: 사용자가 더 복잡한 조건으로 빠르게 검색하고, 자주 사용하는 검색 조건을 저장하여 재사용할 수 있도록 합니다.

*   **2.1: 백엔드 - Full-Text Search 도입**
    *   Django의 내장 기능인 `django.contrib.postgres.search`를 활용하여 PostgreSQL 기반의 Full-Text Search를 구현합니다.
    *   `Score` 모델의 제목, 작곡가 필드를 대상으로 검색 인덱스를 생성합니다.
    *   `/scores` API가 Full-Text Search 쿼리를 처리하도록 `ScoreViewSet`과 `ScoreFilter`를 확장합니다.

*   **2.2: 프론트엔드 - 필터 저장 및 관리 기능 구현**
    *   현재 적용된 필터 조건을 사용자가 원하는 이름으로 저장하는 기능을 구현합니다.
    *   저장된 필터 목록을 불러오고, 이름을 변경하거나 삭제할 수 있는 UI를 `AdvancedFilters` 컴포넌트 내에 추가합니다.
    *   필터링 사이드바의 태그 입력 필드에 자동 완성 기능을 추가하여 사용자 편의성을 높입니다.

*   **2.3: 테스트**
    *   백엔드의 Full-Text Search 로직에 대한 테스트를 작성합니다.
    *   프론트엔드의 필터 저장/불러오기/관리 기능에 대한 단위 테스트 및 E2E 테스트를 구현합니다.

### **Task 3: 성능 최적화 (무한 스크롤)**

**목표**: 수백 개 이상의 악보를 가진 사용자가 목록을 탐색할 때도 끊김 없는 부드러운 경험을 제공합니다.

*   **3.1: 무한 스크롤 구현**
    *   백엔드 API의 페이지네이션(`pagination`)을 활용하여 `useScores` 훅을 수정합니다.
    *   `react-query`의 `useInfiniteQuery`를 도입하여 데이터 로딩 및 캐시 관리를 최적화합니다.
    *   악보 목록 페이지의 기존 페이지네이션 UI를 스크롤이 끝에 도달하면 다음 페이지를 자동으로 불러오는 방식으로 변경합니다.

*   **3.2: 테스트**
    *   무한 스크롤이 정확하게 동작하고, 모든 항목이 중복이나 누락 없이 로드되는지 E2E 테스트를 통해 검증합니다.

### **Task 4: 협업 기능 도입 (세트리스트 공유)**

**목표**: 사용자가 생성한 세트리스트를 다른 사람에게 공유할 수 있는 기반을 마련합니다.

*   **4.1: 백엔드 - 공유 모델 및 API 개발**
    *   `Setlist` 모델에 공유 상태(예: `private`, `public_read_only`)와 고유 공유 ID(`shared_id`) 필드를 추가합니다.
    *   세트리스트 공유 링크를 생성하고, 공유 상태를 변경하는 API 엔드포인트를 개발합니다.
    *   공유 링크를 통해 접근 시, 소유자가 아닌 경우 읽기만 가능하도록 권한 관리 로직을 구현합니다.

*   **4.2: 프론트엔드 - 공유 UI/UX 구현**
    *   세트리스트 상세 페이지에 '공유' 버튼을 추가합니다.
    *   공유 설정을 관리하고, 생성된 공유 링크를 복사할 수 있는 모달 창을 구현합니다.
    *   로그인하지 않은 사용자도 공유 링크를 통해 세트리스트를 볼 수 있는 공개용 페이지를 개발합니다.

*   **4.3: 테스트**
    *   공유 관련 API의 권한 관리 로직을 테스트합니다.
    *   세트리스트 공유 및 조회 플로우에 대한 E2E 테스트를 작성합니다.

## 4. 예상 타임라인

*   **Task 1 (고급 PDF 뷰어):** 1.5주
*   **Task 2 (고급 검색):** 1.5주
*   **Task 3 (성능 최적화):** 1주
*   **Task 4 (세트리스트 공유):** 1주
*   **총 예상 기간:** 약 5주

## 5. 성공 지표

*   Phase 4에서 계획된 모든 기능이 안정적으로 구현 및 배포 완료.
*   E2E 테스트 커버리지 95% 이상 달성.
*   Lighthouse 등을 이용한 성능 측정 시, 성능 저하가 없거나 개선됨.
*   새로운 기능에 대한 사용자 피드백 수렴 및 긍정적 평가 확보.

## 6. 다음 단계

1.  본 Phase 4 계획을 검토하고 최종 승인합니다.
2.  승인 후, **Task 1: 고급 PDF 뷰어 구현**부터 개발을 시작합니다.
