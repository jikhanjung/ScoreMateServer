# Phase 2: 세트리스트 관리 기능 구현 상세 계획

**날짜**: 2025년 8월 20일
**작성자**: Gemini
**문서 목적**: 통합 로드맵(`033`)에 정의된 Phase 2의 목표를 달성하기 위한 세부적인 기술 구현 계획과 절차를 수립합니다.

---

## 1. 목표

백엔드에 구현된 Setlist API를 프론트엔드에서 완벽하게 사용할 수 있도록 UI와 로직을 구현합니다. 사용자가 공연을 위해 악보 목록을 만들고, 곡을 추가/삭제/재정렬하며, 세트리스트를 복제하는 등 전체 관리 워크플로우를 완성합니다.

---

## 2. 주요 구현 기능

- [ ] **세트리스트 CRUD**: 세트리스트를 생성, 조회, 수정, 삭제하는 기능
- [ ] **세트리스트 아이템 관리**: 세트리스트에 악보를 추가하고 제거하는 기능
- [ ] **순서 변경**: 드래그앤드롭(Drag & Drop)으로 세트리스트 내 악보 순서를 변경하는 기능
- [ ] **세트리스트 복제**: 기존 세트리스트를 복사하여 새로운 세트리스트를 만드는 기능

---

## 3. 세부 개발 계획

### Step 1: 데이터 흐름 및 상태 관리 설계 (Custom Hooks)

- **`useSetlists` 훅 생성 (`/hooks/useSetlists.ts`)**
  - 기능: 사용자의 모든 세트리스트 목록을 조회 (`GET /api/v1/setlists/`)
  - `useQuery`를 사용하여 데이터 페칭, 캐싱, 로딩/에러 상태 관리
  - `useMutation`을 사용하여 세트리스트 생성, 수정, 삭제, 복제 기능 구현

- **`useSetlistDetail` 훅 생성 (`/hooks/useSetlistDetail.ts`)**
  - 기능: 특정 세트리스트의 상세 정보와 포함된 악보 목록을 조회 (`GET /api/v1/setlists/{id}/`)
  - `useMutation`을 사용하여 아이템 추가, 삭제, 순서 변경 기능 구현

### Step 2: 세트리스트 목록 페이지 UI 구현

- **파일 위치**: `/app/setlists/page.tsx` (신규 생성)
- **구현 내용**:
  - `useSetlists` 훅을 호출하여 데이터 연동
  - 조회된 세트리스트 목록을 카드 또는 리스트 형태로 표시
  - **[생성]** ‘새 세트리스트 만들기’ 버튼 및 모달 UI 구현
    - 모달에서 `useSetlists`의 생성 뮤테이션(mutation)을 호출
  - **[수정/삭제/복제]** 각 세트리스트 아이템에 ‘수정’, ‘삭제’, ‘복제’ 버튼 배치
    - 각 버튼 클릭 시 `useSetlists`의 해당 뮤테이션 호출
    - 삭제/복제 시 확인(confirm) 모달 추가

### Step 3: 세트리스트 상세 페이지 UI 구현

- **파일 위치**: `/app/setlists/[id]/page.tsx` (신규 생성)
- **구현 내용**:
  - `useSetlistDetail` 훅을 호출하여 데이터 연동
  - 세트리스트의 제목, 설명 등 정보 표시
  - 세트리스트에 포함된 악보(아이템) 목록을 순서대로 표시
  - **[아이템 추가]** ‘악보 추가’ 버튼 구현
    - 클릭 시 사용자의 전체 악보 라이브러리를 보여주는 모달 창 표시
    - 모달에서 악보를 선택하면 `useSetlistDetail`의 아이템 추가 뮤테이션 호출
  - **[아이템 삭제]** 각 아이템 옆에 ‘삭제’ 버튼 배치 및 뮤테이션 연동

### Step 4: 드래그앤드롭 순서 변경 기능 구현

- **적용 위치**: `/app/setlists/[id]/page.tsx`의 악보 목록
- **기술 스택**: `@dnd-kit/core`, `@dnd-kit/sortable` 라이브러리 활용
- **구현 내용**:
  - 악보 목록을 `SortableContext`로 감싸고, 각 아이템을 `useSortable` 훅을 사용하는 컴포넌트로 구현
  - 드래그가 끝나면(onDragEnd), 변경된 순서 정보를 `useSetlistDetail`의 순서 변경 뮤테이션으로 전달
  - **(UX)** Optimistic Update를 적용하여 서버 응답을 기다리지 않고 UI 상에서 순서가 즉시 변경되도록 구현

---

## 4. 기술 스택 및 라이브러리

- **상태 관리**: `@tanstack/react-query` (`useQuery`, `useMutation`)
- **드래그앤드롭**: `@dnd-kit/core`, `@dnd-kit/sortable`
- **UI 컴포넌트**: 기존 `components/ui`의 `Button`, `Modal`, `Card` 등 재활용

---

## 5. 다음 단계

이 계획에 따라 **Step 1: `useSetlists`, `useSetlistDetail` Custom Hook 생성**부터 개발을 시작합니다.
