### **모노레포 구조 설정 계획 (Next.js 프론트엔드 + Django 백엔드)**

**날짜**: 2025-08-19  
**목적**: 기존 Django 프로젝트를 `backend/` 디렉토리로 이동하고, 동일한 저장소 내 `frontend/` 디렉토리에 Next.js 프론트엔드를 설정하여 모노레포 구조로 전환합니다.

---

## 1. 개요

현재 ScoreMateServer 프로젝트는 Django 백엔드 코드가 저장소의 루트에 위치하고 있습니다. Next.js 프론트엔드를 추가함에 따라, 두 프로젝트를 하나의 저장소에서 효율적으로 관리하기 위해 모노레포 구조로 전환하고자 합니다.

## 2. 상세 설정 단계

### 단계 1: `backend/` 디렉토리 생성 및 Django 프로젝트 파일 이동

*   **목표**: 현재 저장소 루트에 있는 모든 Django 관련 파일과 디렉토리를 `backend/`라는 새로운 디렉토리 아래로 이동시킵니다.
*   **수행 내용**:
    1.  저장소 루트에 `backend/` 디렉토리를 생성합니다.
    2.  다음 파일 및 디렉토리를 `backend/` 디렉토리 안으로 이동시킵니다:
        *   `manage.py`
        *   `scoremateserver/` (Django 프로젝트 설정 디렉토리)
        *   `core/` (Django 앱)
        *   `scores/` (Django 앱)
        *   `setlists/` (Django 앱)
        *   `files/` (Django 앱)
        *   `tasks/` (Django 앱)
        *   `scoremate_admin/` (Django 앱)
        *   `requirements.txt`
        *   `Dockerfile.web`
        *   `Dockerfile.worker`
*   **이동하지 않을 파일/디렉토리 (저장소 루트에 유지):**
    *   `.git/` (Git 저장소 정보)
    *   `.gitignore` (Git 무시 규칙)
    *   `docker-compose.yml` (Docker Compose 설정)
    *   `.env`, `.env.example` (환경 변수 파일)
    *   `nginx/` (Nginx 설정)
    *   `tests/` (통합 테스트 디렉토리)
    *   `devlog/` (개발 로그 디렉토리)
    *   `README.md`, `ARCHITECTURE.md` 등 문서 파일

### 단계 2: `frontend/` 디렉토리 생성 및 Next.js 프로젝트 초기화

*   **목표**: Next.js 프론트엔드 프로젝트를 위한 디렉토리를 생성하고, Next.js 프로젝트를 초기화합니다.
*   **수행 내용**:
    1.  저장소 루트에 `frontend/` 디렉토리를 생성합니다.
    2.  `frontend/` 디렉토리 안에서 Next.js 프로젝트를 초기화합니다. TypeScript, Tailwind CSS, App Router를 포함하여 생성합니다.
        ```bash
        cd frontend
        npx create-next-app@latest . --typescript --tailwind --app
        cd ..
        ```

### 단계 3: `docker-compose.yml` 업데이트

*   **목표**: 모노레포 구조에 맞게 Docker Compose 설정을 조정하고, Next.js 프론트엔드 서비스를 추가합니다.
*   **수행 내용**:
    1.  `web` 서비스의 `build.context`를 `./backend`로 변경합니다.
    2.  `worker` 서비스의 `build.context`를 `./backend`로 변경합니다.
    3.  `web` 서비스의 `dockerfile` 경로를 `backend/Dockerfile.web`으로 변경합니다.
    4.  `worker` 서비스의 `dockerfile` 경로를 `backend/Dockerfile.worker`로 변경합니다.
    5.  `frontend` 서비스를 추가합니다. (개발용 Next.js 서버를 실행하도록 설정)
        ```yaml
        # docker-compose.yml (추가 및 수정 예시)
        services:
          # ... 기존 db, cache, storage ...

          web:
            build:
              context: ./backend # 변경
              dockerfile: Dockerfile.web # 변경
            # ...

          worker:
            build:
              context: ./backend # 변경
              dockerfile: Dockerfile.worker # 변경
            # ...

          frontend: # 새로 추가
            build:
              context: ./frontend
              dockerfile: Dockerfile # Next.js 기본 Dockerfile
            ports:
              - "3000:3000"
            volumes:
              - ./frontend:/app
              - /app/node_modules # node_modules는 호스트에 마운트하지 않음
            command: npm run dev # 개발 서버 실행
            environment:
              - NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1 # 백엔드 API URL
            depends_on:
              - web # 백엔드 서비스에 의존

          nginx:
            # ... 기존 설정 유지, frontend 서비스로의 프록시 추가 고려 ...
        ```
    6.  `nginx` 설정에서 `frontend` 서비스로의 프록시 규칙을 추가하여, `/api/` 요청은 `web`으로, 나머지 요청은 `frontend`로 라우팅하도록 조정합니다.

### 단계 4: `.gitignore` 업데이트

*   **목표**: Next.js 프로젝트에서 생성되는 불필요한 파일들이 Git에 의해 추적되지 않도록 `.gitignore` 파일을 업데이트합니다.
*   **수행 내용**:
    1.  저장소 루트의 `.gitignore` 파일에 다음 내용을 추가합니다:
        ```
        # Next.js specific
        /frontend/.next/
        /frontend/out/
        /frontend/node_modules/
        ```

### 단계 5: Docker 이미지 재빌드 및 서비스 재시작

*   **목표**: 변경된 Dockerfile 및 Docker Compose 설정에 따라 이미지를 재빌드하고 모든 서비스를 재시작하여 모노레포 환경을 활성화합니다.
*   **수행 내용**:
    ```bash
    docker compose build # 모든 서비스 이미지 재빌드
    docker compose up -d # 모든 서비스 재시작
    ```

---

## 3. 다음 단계

이 계획이 완료되면, `backend/` 디렉토리에서 Django 백엔드가, `frontend/` 디렉토리에서 Next.js 프론트엔드가 독립적으로 개발될 수 있는 모노레포 환경이 구축됩니다.

이 계획에 따라 진행하시겠습니까?
