### **1단계 개발 완료 내용 자동화 테스트 계획**

**1. 목표:**
*   1단계에서 구현된 모든 핵심 데이터 모델(User, Score, Setlist, SetlistItem, Task, ReferralLog, BillingLog, AccessLog)의 정확한 동작을 검증합니다.
*   모델 간의 관계 및 커스텀 메서드, 속성들이 올바르게 작동하는지 확인합니다.
*   Django Admin 인터페이스의 설정 및 기능이 올바른지 검증합니다.

**2. 테스트 범위:**
*   **모델 유닛 테스트**: 각 모델의 필드 정의, 유효성 검사, 기본값, `__str__` 메서드, 커스텀 메서드(예: `available_quota_mb`, `can_upload()`) 및 속성(`item_count`)
*   **모델 통합 테스트**: 모델 간의 관계(ForeignKey, ManyToMany), CASCADE 동작, `unique_together` 제약조건
*   **Django Admin 테스트**: Admin에 모델이 올바르게 등록되었는지, `list_display`, `list_filter`, `search_fields`, `inlines` 등 커스텀 Admin 설정이 올바르게 적용되었는지

**3. 사용 도구 및 프레임워크:**
*   **`pytest`**: Python 테스트 프레임워크.
*   **`pytest-django`**: `pytest`와 Django를 통합하여 Django의 테스트 기능을 활용할 수 있게 해주는 플러그인.
*   **`factory_boy`**: 테스트 데이터(픽스처)를 쉽고 효율적으로 생성하기 위한 라이브러리.

**4. 테스트 전략:**

*   **테스트 디렉토리 구조**:
    프로젝트 루트에 `tests/` 디렉토리를 생성하고, 각 앱별로 테스트 파일을 구성합니다.
    ```
    .
    ├── tests/
    │   ├── __init__.py
    │   ├── conftest.py  # pytest 설정 및 픽스처 정의
    │   ├── core/
    │   │   ├── __init__.py
    │   │   ├── test_models.py
    │   │   └── test_admin.py
    │   ├── scores/
    │   │   ├── __init__.py
    │   │   ├── test_models.py
    │   │   └── test_admin.py
    │   └── ... (다른 앱들도 유사하게 구성)
    └── (각 Django 앱 디렉토리)
        ├── models.py
        ├── admin.py
        └── ...
    ```

*   **테스트 클래스**:
    *   데이터베이스 접근이 필요한 테스트는 `django.test.TestCase`를 상속받아 작성합니다. 이는 각 테스트 메서드 실행 전후에 데이터베이스를 초기화하여 테스트 간의 독립성을 보장합니다.
    *   `factory_boy`를 사용하여 테스트에 필요한 모델 인스턴스를 효율적으로 생성합니다.

*   **테스트 내용 (예시):**

    *   **`core/test_models.py`**:
        *   `User` 모델의 `available_quota_mb` 및 `quota_usage_percentage` 계산이 정확한지 테스트.
        *   `can_upload()` 메서드가 쿼터에 따라 올바른 값을 반환하는지 테스트.
        *   `ReferralLog`, `BillingLog`, `AccessLog` 모델의 필드 유효성 검사.

    *   **`scores/test_models.py`**:
        *   `Score` 모델의 `s3_key` 및 `thumbnail_key` 생성 메서드가 올바른 경로를 반환하는지 테스트.
        *   `tags` 필드(ArrayField)에 태그 추가 및 조회가 올바른지 테스트.
        *   `content_hash` 필드의 중복 감지 로직 테스트.

    *   **`setlists/test_models.py`**:
        *   `SetlistItem` 추가 시 `order_index`가 올바르게 자동 할당되는지 테스트.
        *   `Setlist`의 `item_count` 및 `total_pages` 프로퍼티가 정확한지 테스트.
        *   `SetlistItem` 삭제 시 `Setlist`의 통계가 올바르게 업데이트되는지 테스트.

    *   **`tasks/test_models.py`**:
        *   `Task` 모델의 상태 변경 메서드(`mark_running()`, `mark_succeeded()`, `mark_failed()`)가 올바르게 작동하는지 테스트.
        *   `try_count` 증가 및 `log` 기록 테스트.

    *   **`test_admin.py` (각 앱별 또는 통합)**:
        *   `django.contrib.admin.site.register`를 통해 모델이 Admin에 등록되었는지 확인.
        *   `ModelAdmin` 클래스의 `list_display`, `list_filter`, `search_fields` 등이 예상대로 작동하는지 `django.test.Client`를 사용하여 Admin 페이지에 접근하여 테스트.

**5. 테스트 실행:**
*   가상 환경 활성화 후, 프로젝트 루트 디렉토리에서 다음 명령어를 실행합니다:
    `pytest`
