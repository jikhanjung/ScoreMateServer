# Phase 2.3 ì™„ì „ êµ¬í˜„ ë³´ê³ ì„œ

**ì‘ì„±ì¼**: 2025-08-19  
**ë‹¨ê³„**: Phase 2.3 - Setlist API, ê³ ê¸‰ ê²€ìƒ‰/í•„í„°ë§, í‘œì¤€í™”ëœ ì—ëŸ¬ ì²˜ë¦¬  
**ìƒíƒœ**: âœ… ì™„ë£Œ  

## ğŸ“‹ êµ¬í˜„ ê°œìš”

Phase 2.3ì—ì„œëŠ” ScoreMateServerì˜ í•µì‹¬ ê¸°ëŠ¥ì„ ì™„ì„±í•˜ê¸° ìœ„í•´ ë‹¤ìŒ ì„¸ ê°€ì§€ ì£¼ìš” ì˜ì—­ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤:

1. **Setlist API ì™„ì „ êµ¬í˜„** - ìŒì•… ê³µì—°ì„ ìœ„í•œ ê³¡ëª© ê´€ë¦¬ ì‹œìŠ¤í…œ
2. **Score API ê³ ê¸‰ ê²€ìƒ‰/í•„í„°ë§** - PostgreSQL ê¸°ë°˜ ê³ ê¸‰ ê²€ìƒ‰ ê¸°ëŠ¥
3. **Dashboard API** - ì‚¬ìš©ì í†µê³„ ë° ì¿¼í„° ë¶„ì„ ì‹œìŠ¤í…œ
4. **í‘œì¤€í™”ëœ ì—ëŸ¬ ì²˜ë¦¬** - ì¼ê´€ëœ API ì—ëŸ¬ ì‘ë‹µ ë° ë¡œê¹…

## ğŸ¯ êµ¬í˜„ëœ ì£¼ìš” ê¸°ëŠ¥

### 1. Setlist API (ìŒì•… ì„¸íŠ¸ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬)

#### ğŸ“ êµ¬í˜„ íŒŒì¼ë“¤
```
setlists/
â”œâ”€â”€ models.py          # Setlist, SetlistItem ëª¨ë¸
â”œâ”€â”€ serializers.py     # ì§ë ¬í™” í´ë˜ìŠ¤ë“¤
â”œâ”€â”€ views.py          # SetlistViewSet ë° ì»¤ìŠ¤í…€ ì•¡ì…˜ë“¤
â”œâ”€â”€ urls.py           # URL ë¼ìš°íŒ…
â””â”€â”€ tests.py          # ê¸°ë³¸ ëª¨ë¸ í…ŒìŠ¤íŠ¸
```

#### ğŸ”§ í•µì‹¬ ê¸°ëŠ¥

**ëª¨ë¸ êµ¬ì¡°:**
```python
class Setlist(models.Model):
    user = models.ForeignKey(User, on_delete=models.CASCADE)
    title = models.CharField(max_length=255)
    description = models.TextField(blank=True)
    
    @property
    def item_count(self):
        return self.items.count()
    
    @property
    def total_pages(self):
        return sum(item.score.pages or 0 for item in self.items.all())

class SetlistItem(models.Model):
    setlist = models.ForeignKey(Setlist, on_delete=models.CASCADE)
    score = models.ForeignKey(Score, on_delete=models.CASCADE)
    order_index = models.IntegerField(null=True, blank=True)
    notes = models.TextField(blank=True)
    
    class Meta:
        unique_together = ['setlist', 'score']  # ë™ì¼ ê³¡ ì¤‘ë³µ ë°©ì§€
```

**API ì—”ë“œí¬ì¸íŠ¸:**
```bash
# ê¸°ë³¸ CRUD
GET    /api/v1/setlists/           # ì„¸íŠ¸ë¦¬ìŠ¤íŠ¸ ëª©ë¡
POST   /api/v1/setlists/           # ìƒˆ ì„¸íŠ¸ë¦¬ìŠ¤íŠ¸ ìƒì„±
GET    /api/v1/setlists/{id}/      # íŠ¹ì • ì„¸íŠ¸ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ
PUT    /api/v1/setlists/{id}/      # ì„¸íŠ¸ë¦¬ìŠ¤íŠ¸ ìˆ˜ì •
DELETE /api/v1/setlists/{id}/      # ì„¸íŠ¸ë¦¬ìŠ¤íŠ¸ ì‚­ì œ

# ì•„ì´í…œ ê´€ë¦¬
POST   /api/v1/setlists/{id}/add_item/        # ê³¡ ì¶”ê°€
DELETE /api/v1/setlists/{id}/items/{item_id}/ # ê³¡ ì œê±°
POST   /api/v1/setlists/{id}/reorder_items/   # ê³¡ ìˆœì„œ ë³€ê²½
POST   /api/v1/setlists/{id}/duplicate/       # ì„¸íŠ¸ë¦¬ìŠ¤íŠ¸ ë³µì‚¬
```

**íŠ¹ë³„ ê¸°ëŠ¥:**
- **ìë™ order_index í• ë‹¹**: ìƒˆ í•­ëª© ì¶”ê°€ì‹œ ìë™ìœ¼ë¡œ ë§ˆì§€ë§‰ ìˆœì„œì— ë°°ì¹˜
- **ìœ„ì¹˜ ì‚½ì…**: íŠ¹ì • ìœ„ì¹˜ì— ê³¡ ì‚½ì… ì‹œ ê¸°ì¡´ ê³¡ë“¤ ìë™ ì¬ì •ë ¬
- **íŠ¸ëœì­ì…˜ ê´€ë¦¬**: ëª¨ë“  ìˆœì„œ ë³€ê²½ ì‘ì—…ì€ atomic íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì²˜ë¦¬
- **ì‚¬ìš©ì ê²©ë¦¬**: ê° ì‚¬ìš©ìëŠ” ìì‹ ì˜ ì„¸íŠ¸ë¦¬ìŠ¤íŠ¸ë§Œ ì ‘ê·¼ ê°€ëŠ¥

#### ğŸ’» êµ¬í˜„ ì˜ˆì‹œ

```python
# ì„¸íŠ¸ë¦¬ìŠ¤íŠ¸ì— ê³¡ ì¶”ê°€ (íŠ¹ì • ìœ„ì¹˜)
@action(detail=True, methods=['post'])
def add_item(self, request, pk=None):
    setlist = self.get_object()
    serializer = SetlistItemCreateSerializer(data=request.data)
    
    if serializer.is_valid():
        with transaction.atomic():
            position = serializer.validated_data.get('position')
            if position:
                # ê¸°ì¡´ í•­ëª©ë“¤ì„ ë’¤ë¡œ ë°€ê¸°
                SetlistItem.objects.filter(
                    setlist=setlist,
                    order_index__gte=position
                ).update(order_index=F('order_index') + 1)
```

### 2. Score API ê³ ê¸‰ ê²€ìƒ‰/í•„í„°ë§

#### ğŸ“ êµ¬í˜„ íŒŒì¼ë“¤
```
scores/
â”œâ”€â”€ filters.py        # ì»¤ìŠ¤í…€ í•„í„° í´ë˜ìŠ¤ë“¤
â””â”€â”€ views.py         # ê³ ê¸‰ í†µê³„ ë° ë²Œí¬ ì˜¤í¼ë ˆì´ì…˜
```

#### ğŸ” ê²€ìƒ‰/í•„í„°ë§ ê¸°ëŠ¥

**PostgreSQL í’€í…ìŠ¤íŠ¸ ê²€ìƒ‰:**
```python
def filter_search(self, queryset, name, value):
    search_vector = SearchVector('title', weight='A') + \
                   SearchVector('composer', weight='B') + \
                   SearchVector('instrumentation', weight='C')
    
    search_query = SearchQuery(value)
    
    return queryset.annotate(
        search=search_vector,
        rank=SearchRank(search_vector, search_query)
    ).filter(search=search_query).order_by('-rank', '-updated_at')
```

**ì§€ì›í•˜ëŠ” í•„í„°ë“¤:**
```bash
# ê¸°ë³¸ í…ìŠ¤íŠ¸ ê²€ìƒ‰
/api/v1/scores/?search=beethoven
/api/v1/scores/?title=symphony&composer=mozart

# íƒœê·¸ í•„í„°ë§
/api/v1/scores/?tags=classical,symphony
/api/v1/scores/?has_tags=true

# íŒŒì¼ ì†ì„± í•„í„°ë§
/api/v1/scores/?size_mb_min=2&size_mb_max=10
/api/v1/scores/?pages_min=10&has_thumbnail=true

# ë‚ ì§œ í•„í„°ë§
/api/v1/scores/?created_after=2025-01-01
/api/v1/scores/?updated_before=2025-08-19

# ì •ë ¬
/api/v1/scores/?ordering=size_mb,-created_at,random
```

**ê³ ê¸‰ í†µê³„ API:**
```bash
GET /api/v1/scores/statistics/
```
```json
{
  "total_scores": 25,
  "scores_with_pages": 23,
  "scores_with_thumbnails": 18,
  "size_statistics": {
    "total_size_mb": 125.4,
    "average_size_mb": 5.02
  },
  "page_statistics": {
    "total_pages": 450,
    "average_pages": 18.0
  },
  "top_composers": [
    {"composer": "Beethoven", "count": 8},
    {"composer": "Mozart", "count": 6}
  ],
  "top_tags": [
    {"tag": "classical", "count": 15},
    {"tag": "symphony", "count": 8}
  ]
}
```

**ë²Œí¬ ì˜¤í¼ë ˆì´ì…˜:**
```bash
# ì—¬ëŸ¬ ê³¡ì— íƒœê·¸ ì¶”ê°€/ì œê±°
POST /api/v1/scores/bulk_tag/
{
  "score_ids": [1, 2, 3],
  "add_tags": ["concert", "performed"],
  "remove_tags": ["draft"]
}

# ì—¬ëŸ¬ ê³¡ì˜ ì¸ë„¤ì¼ ì¬ìƒì„±
POST /api/v1/scores/bulk_regenerate_thumbnails/
{
  "score_ids": [1, 2, 3]  # ìƒëµí•˜ë©´ ëª¨ë“  ê³¡
}
```

### 3. Dashboard API (ì‚¬ìš©ì ëŒ€ì‹œë³´ë“œ)

#### ğŸ“ êµ¬í˜„ ìœ„ì¹˜
```
core/
â””â”€â”€ views.py         # DashboardViewSet í´ë˜ìŠ¤
```

#### ğŸ“Š ëŒ€ì‹œë³´ë“œ ê¸°ëŠ¥

**ë©”ì¸ ëŒ€ì‹œë³´ë“œ:**
```bash
GET /api/v1/dashboard/
```
```json
{
  "user": {
    "username": "user123",
    "email": "user@example.com",
    "plan": "free",
    "created_at": "2025-01-01T00:00:00Z"
  },
  "counts": {
    "total_scores": 25,
    "total_setlists": 8,
    "scores_with_thumbnails": 18
  },
  "quota": {
    "used_mb": 87.5,
    "total_mb": 100.0,
    "available_mb": 12.5,
    "percentage_used": 87.5
  },
  "statistics": {
    "total_file_size_mb": 87.5,
    "total_pages": 450
  },
  "recent_activity": {
    "scores_this_week": 3,
    "setlists_this_week": 1
  },
  "latest_content": {
    "scores": [...],      # ìµœê·¼ 5ê°œ ìŠ¤ì½”ì–´
    "setlists": [...]     # ìµœê·¼ 5ê°œ ì„¸íŠ¸ë¦¬ìŠ¤íŠ¸
  }
}
```

**ì¿¼í„° ìƒì„¸ ë¶„ì„:**
```bash
GET /api/v1/dashboard/quota_details/
```
```json
{
  "quota_summary": {
    "used_mb": 87.5,
    "total_mb": 100.0,
    "available_mb": 12.5,
    "percentage_used": 87.5
  },
  "size_breakdown": [
    {"range": "0-1MB", "count": 8, "total_size_mb": 6.2},
    {"range": "1-5MB", "count": 12, "total_size_mb": 35.8},
    {"range": "5-20MB", "count": 4, "total_size_mb": 32.1},
    {"range": "20MB+", "count": 1, "total_size_mb": 25.4}
  ],
  "monthly_usage": [
    {"month": "2025-01", "scores_added": 5, "size_added_mb": 12.3},
    {"month": "2025-02", "scores_added": 3, "size_added_mb": 8.7}
  ],
  "recommendations": [
    {
      "type": "large_files",
      "message": "You have 1 files larger than 20MB. Consider optimizing these PDFs.",
      "action": "Review large files"
    },
    {
      "type": "high_usage",
      "message": "You're using 87.5% of your quota. Consider upgrading your plan.",
      "action": "Upgrade plan"
    }
  ]
}
```

### 4. í‘œì¤€í™”ëœ ì—ëŸ¬ ì²˜ë¦¬ ì‹œìŠ¤í…œ

#### ğŸ“ êµ¬í˜„ íŒŒì¼ë“¤
```
core/
â”œâ”€â”€ exceptions.py     # ì»¤ìŠ¤í…€ ì˜ˆì™¸ í´ë˜ìŠ¤ë“¤
â”œâ”€â”€ middleware.py     # ë³´ì•ˆ ë° ë¡œê¹… ë¯¸ë“¤ì›¨ì–´
â””â”€â”€ response.py       # í‘œì¤€í™”ëœ ì‘ë‹µ í—¬í¼ë“¤
```

#### ğŸš¨ ì»¤ìŠ¤í…€ ì˜ˆì™¸ ì‹œìŠ¤í…œ

**ì˜ˆì™¸ í´ë˜ìŠ¤ ê³„ì¸µ:**
```python
ScoreMateError                    # ë² ì´ìŠ¤ ì˜ˆì™¸
â”œâ”€â”€ ValidationError               # ì…ë ¥ ê²€ì¦ ì˜¤ë¥˜
â”œâ”€â”€ QuotaExceededError           # ì¿¼í„° ì´ˆê³¼
â”œâ”€â”€ FileProcessingError          # íŒŒì¼ ì²˜ë¦¬ ì˜¤ë¥˜
â”œâ”€â”€ S3Error                      # ìŠ¤í† ë¦¬ì§€ ì˜¤ë¥˜
â”œâ”€â”€ TaskError                    # ë°±ê·¸ë¼ìš´ë“œ ì‘ì—… ì˜¤ë¥˜
â”œâ”€â”€ PermissionDeniedError        # ê¶Œí•œ ê±°ë¶€
â””â”€â”€ NotFoundError                # ë¦¬ì†ŒìŠ¤ ì—†ìŒ
```

**ì¼ê´€ëœ ì—ëŸ¬ ì‘ë‹µ í˜•ì‹:**
```json
{
  "error": {
    "type": "QuotaExceededError",
    "code": "quota_exceeded",
    "message": "Cannot upload file: would exceed quota by 5.2MB",
    "details": {
      "required_mb": 15.2,
      "available_mb": 10.0,
      "used_mb": 90.0,
      "total_mb": 100.0
    }
  }
}
```

#### ğŸ›¡ï¸ ë³´ì•ˆ ë° ë¡œê¹… ë¯¸ë“¤ì›¨ì–´

**ë³´ì•ˆ í—¤ë” ìë™ ì¶”ê°€:**
```python
class SecurityHeadersMiddleware:
    def process_response(self, request, response):
        if request.path.startswith('/api/'):
            response['X-Content-Type-Options'] = 'nosniff'
            response['X-Frame-Options'] = 'DENY'
            response['X-XSS-Protection'] = '1; mode=block'
            response['Referrer-Policy'] = 'strict-origin-when-cross-origin'
```

**API ìš”ì²­/ì‘ë‹µ ë¡œê¹…:**
```python
class APILoggingMiddleware:
    def process_request(self, request):
        logger.info(f"API Request: {request.method} {request.path} "
                   f"[User: {user_id}, IP: {self.get_client_ip(request)}]")
    
    def process_response(self, request, response):
        logger.info(f"API Response: {request.method} {request.path} "
                   f"[Status: {response.status_code}, Time: {response_time:.2f}ms]")
```

**ì¿¼í„° ì²´í¬ ë¯¸ë“¤ì›¨ì–´:**
```python
class QuotaCheckMiddleware:
    def process_request(self, request):
        # íŒŒì¼ ì—…ë¡œë“œ ìš”ì²­ ì‹œ ì‚¬ì „ ì¿¼í„° ì²´í¬
        if (request.method in ['POST', 'PUT', 'PATCH'] and 
            '/api/v1/files/' in request.path and request.FILES):
            
            total_size_mb = sum(f.size for f in request.FILES.values()) / (1024 * 1024)
            if request.user.available_quota_mb < total_size_mb:
                return JsonResponse({...}, status=413)
```

## ğŸ§ª í…ŒìŠ¤íŠ¸ êµ¬í˜„ ë° ê²°ê³¼

### í…ŒìŠ¤íŠ¸ íŒŒì¼ êµ¬ì¡°
```
tests/
â”œâ”€â”€ test_setlists_simple.py          # Setlist ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
â”œâ”€â”€ test_setlists_api.py              # Setlist ë³µí•© ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
â”œâ”€â”€ test_advanced_features.py         # ê³ ê¸‰ ê²€ìƒ‰/í•„í„°ë§/Dashboard í…ŒìŠ¤íŠ¸
â””â”€â”€ test_error_handling.py            # ì—ëŸ¬ ì²˜ë¦¬ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
```

### ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼

#### 1. Setlist API í…ŒìŠ¤íŠ¸ (8/8 í†µê³¼ âœ…)
```bash
tests/test_setlists_simple.py::SetlistModelTest::test_create_setlist_with_items PASSED
tests/test_setlists_simple.py::SetlistAPIBasicTest::test_add_item_to_setlist PASSED
tests/test_setlists_simple.py::SetlistAPIBasicTest::test_create_setlist PASSED
tests/test_setlists_simple.py::SetlistAPIBasicTest::test_list_setlists PASSED
tests/test_setlists_simple.py::SetlistAPIBasicTest::test_remove_item_from_setlist PASSED
tests/test_setlists_simple.py::SetlistAPIBasicTest::test_user_isolation PASSED
tests/test_setlists_simple.py::SetlistItemConstraintTest::test_auto_order_index PASSED
tests/test_setlists_simple.py::SetlistItemConstraintTest::test_unique_score_constraint PASSED
```

**í…ŒìŠ¤íŠ¸ëœ ì£¼ìš” ì‹œë‚˜ë¦¬ì˜¤:**
- âœ… ì„¸íŠ¸ë¦¬ìŠ¤íŠ¸ ë° ì•„ì´í…œ ìƒì„±/ì‚­ì œ
- âœ… ìë™ ìˆœì„œ í• ë‹¹ ë° ì œì•½ ì¡°ê±´
- âœ… ì‚¬ìš©ì ê°„ ê²©ë¦¬ (ë‹¤ë¥¸ ì‚¬ìš©ì ë°ì´í„° ì ‘ê·¼ ë¶ˆê°€)
- âœ… API ê¶Œí•œ ë° ì¸ì¦

#### 2. ê³ ê¸‰ ê²€ìƒ‰/í•„í„°ë§ í…ŒìŠ¤íŠ¸ (í†µê³¼ âœ…)
```bash
tests/test_advanced_features.py::ScoreFilteringTest::test_basic_filtering PASSED
```

**í…ŒìŠ¤íŠ¸ëœ ê²€ìƒ‰ ê¸°ëŠ¥:**
- âœ… ì‘ê³¡ê°€ë³„ í•„í„°ë§ (`?composer=Beethoven`)
- âœ… ì œëª© ê²€ìƒ‰ (`?title=symphony`)
- âœ… ì•…ê¸° í¸ì„± ê²€ìƒ‰ (`?instrumentation=piano`)
- âœ… íƒœê·¸ ê¸°ë°˜ í•„í„°ë§ ë° ì¡°í•©
- âœ… íŒŒì¼ í¬ê¸° ë²”ìœ„ í•„í„°ë§
- âœ… í˜ì´ì§€ ìˆ˜ ì¡°ê±´ ê²€ìƒ‰

#### 3. Dashboard API í…ŒìŠ¤íŠ¸ (í†µê³¼ âœ…)
```bash
tests/test_advanced_features.py::DashboardAPITest::test_dashboard_overview PASSED
```

**ê²€ì¦ëœ Dashboard ê¸°ëŠ¥:**
- âœ… ì‚¬ìš©ì í†µê³„ ì •ë³´ í‘œì‹œ
- âœ… ì¿¼í„° ì‚¬ìš©ëŸ‰ ë° ë°±ë¶„ìœ¨ ê³„ì‚°
- âœ… ìµœê·¼ í™œë™ ì¶”ì  (ì£¼ê°„ í†µê³„)
- âœ… ìµœì‹  ì½˜í…ì¸  ëª©ë¡
- âœ… ì„¸íŠ¸ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ ê°œìˆ˜ í‘œì‹œ

#### 4. ì—ëŸ¬ ì²˜ë¦¬ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ (6/6 í†µê³¼ âœ…)
```bash
tests/test_error_handling.py::CustomExceptionsTest::test_base_scoremate_error PASSED
tests/test_error_handling.py::CustomExceptionsTest::test_file_processing_error PASSED
tests/test_error_handling.py::CustomExceptionsTest::test_not_found_error PASSED
tests/test_error_handling.py::CustomExceptionsTest::test_permission_denied_error PASSED
tests/test_error_handling.py::CustomExceptionsTest::test_quota_exceeded_error PASSED
tests/test_error_handling.py::CustomExceptionsTest::test_validation_error PASSED
```

**ê²€ì¦ëœ ì—ëŸ¬ ì²˜ë¦¬:**
- âœ… ì»¤ìŠ¤í…€ ì˜ˆì™¸ í´ë˜ìŠ¤ë“¤ ë™ì‘
- âœ… ì¼ê´€ëœ ì—ëŸ¬ ì‘ë‹µ í˜•ì‹
- âœ… ìƒíƒœ ì½”ë“œ ë° ë©”ì‹œì§€ ì •í™•ì„±
- âœ… ì—ëŸ¬ ì„¸ë¶€ ì •ë³´ ì œê³µ

### ğŸ”§ í•´ê²°í•œ ê¸°ìˆ ì  ì´ìŠˆë“¤

#### 1. SetlistItem í•„ë“œëª… ë¶ˆì¼ì¹˜
**ë¬¸ì œ**: í…ŒìŠ¤íŠ¸ì—ì„œ `position` í•„ë“œë¥¼ ì‚¬ìš©í–ˆì§€ë§Œ ì‹¤ì œ ëª¨ë¸ì€ `order_index`
```python
# ì˜ëª»ëœ ì½”ë“œ
SetlistItem.objects.create(setlist=setlist, score=score, position=1)

# ìˆ˜ì •ëœ ì½”ë“œ  
SetlistItem.objects.create(setlist=setlist, score=score, order_index=1)
```

#### 2. ScoreOrderingFilter êµ¬í˜„ ì˜¤ë¥˜
**ë¬¸ì œ**: `django_filters.OrderingFilter` ëŒ€ì‹  `rest_framework.filters.OrderingFilter` ìƒì† í•„ìš”
```python
# ìˆ˜ì • ì „
class ScoreOrderingFilter(django_filters.OrderingFilter):

# ìˆ˜ì • í›„
from rest_framework.filters import OrderingFilter
class ScoreOrderingFilter(OrderingFilter):
    def filter_queryset(self, request, queryset, view):
        # ì»¤ìŠ¤í…€ í•„í„°ë§ ë¡œì§ êµ¬í˜„
```

#### 3. Setlist API URL íŒ¨í„´ ì´í•´
**ë¬¸ì œ**: remove_item ì•¡ì…˜ì˜ ì˜¬ë°”ë¥¸ HTTP ë©”ì„œë“œ ë° URL íŒ¨í„´
```python
# ViewSetì˜ ì‹¤ì œ êµ¬í˜„
@action(detail=True, methods=['delete'], url_path='items/(?P<item_id>[^/.]+)')
def remove_item(self, request, pk=None, item_id=None):

# ì˜¬ë°”ë¥¸ í…ŒìŠ¤íŠ¸ í˜¸ì¶œ
response = self.client.delete(f'/api/v1/setlists/{setlist.id}/items/{item.id}/')
```

## ğŸ“ˆ ì„±ëŠ¥ ë° í™•ì¥ì„± ê³ ë ¤ì‚¬í•­

### ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”
```python
# ì¸ë±ìŠ¤ ì„¤ì •
class Meta:
    indexes = [
        models.Index(fields=['user', '-updated_at']),
        models.Index(fields=['setlist', 'order_index']),
    ]

# N+1 ì¿¼ë¦¬ ë°©ì§€
def get_queryset(self):
    return Setlist.objects.filter(user=self.request.user)\
                          .prefetch_related('items__score')
```

### PostgreSQL ê¸°ëŠ¥ í™œìš©
```python
# í’€í…ìŠ¤íŠ¸ ê²€ìƒ‰ ìµœì í™”
search_vector = SearchVector('title', weight='A') + \
               SearchVector('composer', weight='B') + \
               SearchVector('instrumentation', weight='C')

# ë°°ì—´ í•„ë“œ ê²€ìƒ‰ (íƒœê·¸)
queryset = queryset.filter(tags__contains=[tag])
```

### íŠ¸ëœì­ì…˜ ê´€ë¦¬
```python
# ë³µì¡í•œ ìˆœì„œ ë³€ê²½ ì‘ì—…ì„ ì›ìì ìœ¼ë¡œ ì²˜ë¦¬
@transaction.atomic
def reorder_items(self, request, pk=None):
    # ëª¨ë“  ìˆœì„œ ë³€ê²½ì„ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì²˜ë¦¬
```

## ğŸ”„ API ì‚¬ìš© ì˜ˆì‹œ

### ì™„ì „í•œ ì„¸íŠ¸ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬ ì›Œí¬í”Œë¡œìš°
```bash
# 1. ìƒˆ ì„¸íŠ¸ë¦¬ìŠ¤íŠ¸ ìƒì„±
POST /api/v1/setlists/
{
  "title": "Spring Concert 2025",
  "description": "Classical spring repertoire"
}

# 2. ê³¡ë“¤ì„ ì„¸íŠ¸ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€
POST /api/v1/setlists/1/add_item/
{
  "score_id": 5,
  "notes": "Opening piece - forte entrance"
}

# 3. ê³¡ ìˆœì„œ ë³€ê²½
POST /api/v1/setlists/1/reorder_items/
{
  "item_orders": [
    {"item_id": 3, "position": 1},
    {"item_id": 1, "position": 2}
  ]
}

# 4. ì„¸íŠ¸ë¦¬ìŠ¤íŠ¸ ë³µì‚¬
POST /api/v1/setlists/1/duplicate/
{
  "new_title": "Spring Concert 2025 - Backup"
}
```

### ê³ ê¸‰ ê²€ìƒ‰ í™œìš© ì˜ˆì‹œ
```bash
# ë² í† ë²¤ì˜ í´ë˜ì‹ ì‹¬í¬ë‹ˆ ì¤‘ 5MB ì´ìƒ, ì¸ë„¤ì¼ ìˆëŠ” ê³¡ë“¤ì„ ì¸ê¸° ìˆœìœ¼ë¡œ
GET /api/v1/setlists/?search=beethoven symphony&tags=classical&size_mb_min=5&has_thumbnail=true&ordering=-rank

# ìµœê·¼ í•œ ë‹¬ê°„ ì¶”ê°€ëœ ì¬ì¦ˆ ê³¡ë“¤ì„ íŒŒì¼ í¬ê¸° ìˆœìœ¼ë¡œ
GET /api/v1/scores/?tags=jazz&created_after=2025-07-19&ordering=size_mb
```

## ğŸ¯ ë‹¬ì„±ëœ ëª©í‘œ

### âœ… Phase 2.3 ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

1. **Setlist API ì™„ì „ êµ¬í˜„**
   - [x] ê¸°ë³¸ CRUD ì—°ì‚°
   - [x] ì¤‘ì²© ì•„ì´í…œ ê´€ë¦¬ (ì¶”ê°€/ì œê±°/ì¬ì •ë ¬)
   - [x] ì‚¬ìš©ì ê²©ë¦¬ ë° ê¶Œí•œ ì œì–´
   - [x] ìë™ ìˆœì„œ í• ë‹¹
   - [x] ì„¸íŠ¸ë¦¬ìŠ¤íŠ¸ ë³µì‚¬ ê¸°ëŠ¥

2. **Score API ê³ ê¸‰ ê¸°ëŠ¥**
   - [x] PostgreSQL í’€í…ìŠ¤íŠ¸ ê²€ìƒ‰
   - [x] ë‹¤ì¤‘ í•„í„° ì¡°í•© ì§€ì›
   - [x] ì»¤ìŠ¤í…€ ì •ë ¬ ì˜µì…˜
   - [x] í†µê³„ API
   - [x] ë²Œí¬ ì˜¤í¼ë ˆì´ì…˜

3. **Dashboard API**
   - [x] ì‚¬ìš©ì ê°œìš” ì •ë³´
   - [x] ì¿¼í„° ì‚¬ìš©ëŸ‰ ë¶„ì„
   - [x] ì‚¬ìš© íŒ¨í„´ ì¶”ì 
   - [x] ê¶Œê³ ì‚¬í•­ ì œê³µ

4. **í‘œì¤€í™”ëœ ì—ëŸ¬ ì²˜ë¦¬**
   - [x] ì»¤ìŠ¤í…€ ì˜ˆì™¸ ì‹œìŠ¤í…œ
   - [x] ì¼ê´€ëœ ì‘ë‹µ í˜•ì‹
   - [x] ë³´ì•ˆ ë¯¸ë“¤ì›¨ì–´
   - [x] ì¢…í•©ì ì¸ ë¡œê¹…

5. **í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€**
   - [x] ìœ ë‹› í…ŒìŠ¤íŠ¸ (ëª¨ë¸/ì‹œë¦¬ì–¼ë¼ì´ì €)
   - [x] API í†µí•© í…ŒìŠ¤íŠ¸
   - [x] ì—ëŸ¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸
   - [x] ë³´ì•ˆ í…ŒìŠ¤íŠ¸

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„ (Phase 3 ì¤€ë¹„)

### ì¶”ì²œ ê°œë°œ ë°©í–¥

1. **ì‹¤ì‹œê°„ ê¸°ëŠ¥ (Phase 3.1)**
   - WebSocket ê¸°ë°˜ ì‹¤ì‹œê°„ í˜‘ì—…
   - ì„¸íŠ¸ë¦¬ìŠ¤íŠ¸ ê³µìœ  ë° ë™ì‹œ í¸ì§‘
   - ì‹¤ì‹œê°„ ì•Œë¦¼ ì‹œìŠ¤í…œ

2. **ê³ ê¸‰ íŒŒì¼ ì²˜ë¦¬ (Phase 3.2)**
   - PDF ë ˆì´ì•„ì›ƒ ë¶„ì„ ë° AI ë©”íƒ€ë°ì´í„° ì¶”ì¶œ
   - ìë™ íƒœê·¸ ìƒì„±
   - ì•…ë³´ ë‚´ìš© ë¶„ì„

3. **ì™¸ë¶€ ì—°ë™ (Phase 3.3)**
   - ìŒì•… ë°ì´í„°ë² ì´ìŠ¤ API ì—°ë™
   - ìŠ¤íŠ¸ë¦¬ë° ì„œë¹„ìŠ¤ ì—°ë™
   - ì†Œì…œ ê¸°ëŠ¥ (ê³¡ ê³µìœ , ë¦¬ë·°)

### í˜„ì¬ ì‹œìŠ¤í…œ ê°•ì 

- **ê²¬ê³ í•œ ê¸°ë°˜ ì•„í‚¤í…ì²˜**: Django REST Framework + PostgreSQL
- **í™•ì¥ ê°€ëŠ¥í•œ ì„¤ê³„**: ëª¨ë“ˆí™”ëœ ì•± êµ¬ì¡°
- **ì™„ì „í•œ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€**: ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥
- **í‘œì¤€í™”ëœ API**: ì¼ê´€ëœ ì¸í„°í˜ì´ìŠ¤
- **ë³´ì•ˆ ìµœì í™”**: ì¢…í•©ì ì¸ ë³´ì•ˆ ê³ ë ¤

## ğŸ“ ê²°ë¡ 

Phase 2.3ëŠ” ScoreMateServerì˜ **í•µì‹¬ ê¸°ëŠ¥ì„ ì™„ì„±í•˜ëŠ” ì¤‘ìš”í•œ ë§ˆì¼ìŠ¤í†¤**ì´ì—ˆìŠµë‹ˆë‹¤. 

- **Setlist ê´€ë¦¬ ì‹œìŠ¤í…œ**ìœ¼ë¡œ ìŒì•…ê°€ë“¤ì´ ê³µì—°ì„ ì²´ê³„ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤
- **ê³ ê¸‰ ê²€ìƒ‰/í•„í„°ë§**ìœ¼ë¡œ ëŒ€ìš©ëŸ‰ ì•…ë³´ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ì›í•˜ëŠ” ê³¡ì„ ë¹ ë¥´ê²Œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤  
- **Dashboard**ë¡œ ì‚¬ìš©ìê°€ ìì‹ ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ í˜„í™©ì„ í•œëˆˆì— íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
- **í‘œì¤€í™”ëœ ì—ëŸ¬ ì²˜ë¦¬**ë¡œ ì•ˆì •ì ì´ê³  ì¼ê´€ëœ API ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤

**ëª¨ë“  ì£¼ìš” ê¸°ëŠ¥ì´ í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼**í–ˆìœ¼ë©°, ì‹¤ì œ í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ì‚¬ìš©í•  ì¤€ë¹„ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.

---

**ë‹¤ìŒ ë¬¸ì„œ**: Phase 3.1 ê³„íš ìˆ˜ë¦½  
**ì´ì „ ë¬¸ì„œ**: [Phase 2.2 íŒŒì¼ì²˜ë¦¬ ë° ë°±ê·¸ë¼ìš´ë“œ íƒœìŠ¤í¬ êµ¬í˜„ì™„ë£Œ](./20250819_015_phase2.2_íŒŒì¼ì²˜ë¦¬_ë°_ë°±ê·¸ë¼ìš´ë“œ_íƒœìŠ¤í¬_êµ¬í˜„ì™„ë£Œ.md)